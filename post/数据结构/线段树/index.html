<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">

  <title>线段树 &#8211; NetPipe&#39;s Blog</title>

  
  <meta name="description" content="问题 ¶数组 $A$ 中共 $n$ 个元素，对其反复进行以下操作共 $m$ 次：">
  
  <meta name="author" content="Net Pipe">

  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="../../../index.xml" rel="alternate" type="application/rss+xml" title="NetPipe&#39;s Blog" />
  <link rel="shortcut icon" type="image/x-icon" href="../../../images/freeze.png" />

  
    <style>@font-face {
  font-family: 'Fantasque Sans Mono';
  src: url("/fonts/FantasqueSansMono-Regular.woff2") format("woff2"); }

@font-face {
  font-family: 'Fantasque Sans Mono';
  font-style: normal;
  font-weight: bold;
  src: url("/fonts/FantasqueSansMono-Bold.woff2") format("woff2"); }

@font-face {
  font-family: 'Fantasque Sans Mono';
  font-style: italic;
  src: url("/fonts/FantasqueSansMono-Italic.woff2") format("woff2"); }

@font-face {
  font-family: 'Lazy';
  src: url("/fonts/lazy.ttf") format("truetype"); }

@font-face {
  font-family: 'Material Icons';
  font-style: normal;
  font-weight: 400;
  src: url("/fonts/Material Icons.woff2") format("woff2"); }

/* fallback */
@font-face {
  font-family: 'Material Icons Outlined';
  font-style: normal;
  font-weight: 400;
  src: url("/fonts/Material Icons Outlined.woff2") format("woff2"); }

/* fallback */
@font-face {
  font-family: 'Material Icons Round';
  font-style: normal;
  font-weight: 400;
  src: url("/fonts/Material Icons Round.woff2") format("woff2"); }

/* fallback */
@font-face {
  font-family: 'Material Icons Sharp';
  font-style: normal;
  font-weight: 400;
  src: url("/fonts/Material Icons Sharp.woff2") format("woff2"); }

/* fallback */
@font-face {
  font-family: 'Material Icons Two Tone';
  font-style: normal;
  font-weight: 400;
  src: url("/fonts/Material Icons Two Tone.woff2") format("woff2"); }

.material-icons {
  font-family: 'Material Icons';
  font-weight: normal;
  font-style: normal;
  font-size: 24px;
  line-height: 1;
  letter-spacing: normal;
  text-transform: none;
  display: inline-block;
  white-space: nowrap;
  word-wrap: normal;
  direction: ltr;
  -webkit-font-feature-settings: 'liga';
  -webkit-font-smoothing: antialiased; }

.material-icons-outlined {
  font-family: 'Material Icons Outlined';
  font-weight: normal;
  font-style: normal;
  font-size: 24px;
  line-height: 1;
  letter-spacing: normal;
  text-transform: none;
  display: inline-block;
  white-space: nowrap;
  word-wrap: normal;
  direction: ltr;
  -webkit-font-feature-settings: 'liga';
  -webkit-font-smoothing: antialiased; }

.material-icons-round {
  font-family: 'Material Icons Round';
  font-weight: normal;
  font-style: normal;
  font-size: 24px;
  line-height: 1;
  letter-spacing: normal;
  text-transform: none;
  display: inline-block;
  white-space: nowrap;
  word-wrap: normal;
  direction: ltr;
  -webkit-font-feature-settings: 'liga';
  -webkit-font-smoothing: antialiased; }

.material-icons-sharp {
  font-family: 'Material Icons Sharp';
  font-weight: normal;
  font-style: normal;
  font-size: 24px;
  line-height: 1;
  letter-spacing: normal;
  text-transform: none;
  display: inline-block;
  white-space: nowrap;
  word-wrap: normal;
  direction: ltr;
  -webkit-font-feature-settings: 'liga';
  -webkit-font-smoothing: antialiased; }

.material-icons-two-tone {
  font-family: 'Material Icons Two Tone';
  font-weight: normal;
  font-style: normal;
  font-size: 24px;
  line-height: 1;
  letter-spacing: normal;
  text-transform: none;
  display: inline-block;
  white-space: nowrap;
  word-wrap: normal;
  direction: ltr;
  -webkit-font-feature-settings: 'liga';
  -webkit-font-smoothing: antialiased; }

body,
code,
input {
  font-family: 'Fantasque Sans Mono', sans-serif;
  -webkit-font-smoothing: antialiased; }
  body article h1, body article h2, body article h3, body article h4, body article h5, body article h6, body .posts h1, body .posts h2, body .posts h3, body .posts h4, body .posts h5, body .posts h6,
  code article h1,
  code article h2,
  code article h3,
  code article h4,
  code article h5,
  code article h6,
  code .posts h1,
  code .posts h2,
  code .posts h3,
  code .posts h4,
  code .posts h5,
  code .posts h6,
  input article h1,
  input article h2,
  input article h3,
  input article h4,
  input article h5,
  input article h6,
  input .posts h1,
  input .posts h2,
  input .posts h3,
  input .posts h4,
  input .posts h5,
  input .posts h6 {
    font-weight: normal; }

strong {
  font-weight: normal;
  text-shadow: 0 0; }

* {
  margin: 0;
  padding: 0;
  user-select: none;
  -moz-user-select: none;
  -webkit-user-select: none;
  --aside-width: 18rem;
  --box-shadow: 0 1px 6px 0 rgba(0, 0, 0, 0.1);
  --box-shadow-hover: 0 2px 8px 0 rgba(0, 0, 0, 0.2);
  --color: black;
  --border: 1px solid #dee0e2;
  --border-color: #dee0e2;
  --border-radius: 0.25rem;
  --link-color: #4588be;
  --category-color: rgba(38, 152, 190, 0.7);
  --background-color: white;
  --hover-color: #f7f7f7; }
  * body {
    background-color: #f7f7f7; }

::selection {
  background-color: #CCE2FF;
  color: rgba(0, 0, 0, 0.87); }

::-webkit-scrollbar {
  width: 7px;
  height: 7px; }

::-webkit-scrollbar-thumb {
  border-radius: 10px;
  background: #dddddd; }
  ::-webkit-scrollbar-thumb:hover {
    background: #acacac; }

::-webkit-scrollbar-track {
  border-radius: 10px;
  background: #f0f0f0; }

a {
  text-decoration: none;
  color: #4794d3; }

a:focus, a:hover {
  outline: none;
  text-decoration: underline; }

a.alternate:focus,
a.alternate:hover,
a.alternate:focus > *,
a.alternate:hover > * {
  text-decoration: none;
  background: var(--hover-color); }

small {
  font-size: 70%; }

ol, ul {
  margin: .5rem 0;
  padding-left: 2rem;
  word-break: break-word; }
  ol > li, ul > li {
    margin: .5rem 0; }

ul > li {
  list-style: circle; }

.result {
  width: 100%; }
  .result :first-child .post {
    margin-top: 0; }
  .result :last-child .post {
    margin-bottom: 0; }

.pagination {
  margin: 0;
  padding: 0;
  width: 100%;
  display: flex;
  flex-flow: row nowrap;
  align-items: center;
  justify-content: center;
  font-size: 18px; }
  .pagination div.pagination-box {
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    background-color: var(--background-color);
    color: var(--color);
    margin: 0 .5rem;
    color: var(--link-color);
    width: 2rem;
    height: 2rem;
    line-height: 2rem;
    float: left;
    text-align: center;
    vertical-align: middle;
    cursor: default; }
    .pagination div.pagination-box:hover {
      box-shadow: var(--box-shadow-hover); }
    .pagination div.pagination-box:not(.disabled):hover {
      background-color: var(--hover-color);
      cursor: pointer; }
  .pagination div.prev {
    width: 5rem;
    margin-left: 0; }
  .pagination div.next {
    width: 5rem;
    margin-right: 0; }
  .pagination div.pagination-eldivpsis {
    width: 3rem; }
  .pagination div.disabled {
    color: var(--color); }

.posts .post {
  border-radius: var(--border-radius);
  box-shadow: var(--box-shadow);
  background-color: var(--background-color);
  color: var(--color);
  margin: 1rem 0;
  padding: .7rem 1rem; }
  .posts .post:hover {
    box-shadow: var(--box-shadow-hover); }

.posts :first-child .post {
  margin-top: 0; }

.post-list {
  border: var(--border);
  border-radius: var(--border-radius); }
  .post-list .post-item {
    padding: .3rem .5rem;
    height: 1.5rem; }
    .post-list .post-item * {
      font-size: 100%;
      vertical-align: bottom; }
    .post-list .post-item:hover a {
      color: var(--link-color);
      text-decoration: underline; }

.post-link {
  color: var(--color); }
  .post-link:hover .post-title a {
    color: var(--link-color);
    text-decoration: underline; }

.post-title {
  margin: 0 0 .5rem 0;
  font-size: 20px; }
  .post-title a {
    color: var(--color); }
  .post-title:hover a {
    color: var(--link-color);
    text-decoration: underline; }

.post-meta {
  color: gray; }
  .post-meta img {
    vertical-align: text-bottom; }

.post-categories {
  font-size: 13px; }
  .post-categories a {
    color: white;
    background-color: var(--category-color);
    border-radius: .2rem;
    padding: .2rem .2rem;
    white-space: nowrap; }

.post-summary {
  margin-top: .5rem; }

.post-header {
  margin-bottom: 1rem; }

.post-content {
  text-align: justify;
  background-color: white;
  padding: 1rem; }
  .post-content .md__image {
    display: block;
    max-width: 100%;
    margin: auto; }

.post-content > :first-child,
.post-content > :first-child > :first-child,
.post-content > :first-child > :first-child > :first-child,
.markdown-inner > :first-child,
.markdown-inner > :first-child > :first-child,
.markdown-inner > :first-child > :first-child > :first-child {
  margin-top: 0; }

.post-content > :last-child,
.post-content > :last-child > :last-child,
.post-content > :last-child > :last-child > :last-child,
.markdown-inner > :last-child,
.markdown-inner > :last-child > :last-child,
.markdown-inner > :last-child > :last-child > :last-child {
  margin-bottom: 0; }

.flex-left,
.flex-right {
  flex: 0 0 var(--aside-width); }
  .flex-left div.outer,
  .flex-right div.outer {
    padding: .7rem;
    margin: .3rem;
    width: calc(var(--aside-width) - 2rem);
    height: calc(100% - 2rem);
    position: fixed;
    overflow: auto; }
    .flex-left div.outer::-webkit-scrollbar-track,
    .flex-right div.outer::-webkit-scrollbar-track {
      margin: .7rem; }
    .flex-left div.outer div.avatar,
    .flex-right div.outer div.avatar {
      text-align: center; }
      .flex-left div.outer div.avatar h2,
      .flex-right div.outer div.avatar h2 {
        margin: 1rem; }
      .flex-left div.outer div.avatar .data-left,
      .flex-left div.outer div.avatar .data-right,
      .flex-right div.outer div.avatar .data-left,
      .flex-right div.outer div.avatar .data-right {
        flex: 0 0 50%;
        display: inline-block;
        width: calc(50% - 1rem); }
      .flex-left div.outer div.avatar .data-left,
      .flex-right div.outer div.avatar .data-left {
        border-right: 1px solid var(--color); }
      .flex-left div.outer div.avatar .social,
      .flex-right div.outer div.avatar .social {
        margin-top: 1rem; }
        .flex-left div.outer div.avatar .social .social-box,
        .flex-right div.outer div.avatar .social .social-box {
          border-radius: var(--border-radius);
          box-shadow: 0 1px 6px 0 rgba(0, 0, 0, 0.2);
          transition: all .3s;
          background-color: var(--background-color);
          color: var(--color);
          margin-top: .5rem;
          padding: .5rem;
          text-align: left;
          font-size: 18px; }
          .flex-left div.outer div.avatar .social .social-box:hover,
          .flex-right div.outer div.avatar .social .social-box:hover {
            transform: scale(1.03); }
          .flex-left div.outer div.avatar .social .social-box a,
          .flex-right div.outer div.avatar .social .social-box a {
            color: var(--color); }
          .flex-left div.outer div.avatar .social .social-box:hover a,
          .flex-right div.outer div.avatar .social .social-box:hover a {
            color: var(--link-color);
            text-decoration: underline; }
          .flex-left div.outer div.avatar .social .social-box img,
          .flex-right div.outer div.avatar .social .social-box img {
            vertical-align: text-bottom;
            width: 20px; }
          .flex-left div.outer div.avatar .social .social-box .search,
          .flex-right div.outer div.avatar .social .social-box .search {
            display: inline-block;
            width: calc(100% - 36px); }
            .flex-left div.outer div.avatar .social .social-box .search > input,
            .flex-right div.outer div.avatar .social .social-box .search > input {
              background-color: var(--background-color);
              color: var(--color);
              border: none;
              font-size: 17px;
              outline: none;
              width: 100%; }
    .flex-left div.outer div.categories .post-categories,
    .flex-right div.outer div.categories .post-categories {
      margin: .5rem 0;
      line-height: 1.7rem; }
    .flex-left div.outer #TableOfContents > ul,
    .flex-right div.outer #TableOfContents > ul {
      padding-left: 0;
      margin-bottom: -.5rem; }
      .flex-left div.outer #TableOfContents > ul li,
      .flex-right div.outer #TableOfContents > ul li {
        list-style: none; }
  .flex-left div.inner,
  .flex-right div.inner {
    direction: ltr;
    background-color: var(--background-color);
    color: var(--color);
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    box-sizing: border-box;
    width: calc(var(--aside-width) - 2rem);
    padding: .5rem;
    margin-bottom: 1rem;
    overflow: auto;
    padding: 1rem; }
    .flex-left div.inner:hover,
    .flex-right div.inner:hover {
      box-shadow: var(--box-shadow-hover); }
    .flex-left div.inner h2,
    .flex-right div.inner h2 {
      margin: 0 0 .5rem 0;
      line-height: 20px; }
      .flex-left div.inner h2 > img,
      .flex-right div.inner h2 > img {
        vertical-align: -2px;
        width: 20px;
        height: 20px;
        margin-right: .5rem; }
    .flex-left div.inner ul,
    .flex-right div.inner ul {
      padding-left: 1rem; }
    .flex-left div.inner:last-of-type,
    .flex-right div.inner:last-of-type {
      margin-bottom: 0; }

.flex-left {
  margin-right: -1rem; }

.flex-right {
  margin-left: -1rem; }

.flex-hidden {
  display: none; }

body {
  max-width: 75rem;
  margin: 0 auto;
  overflow: hidden scroll; }

main {
  display: flex; }

article {
  overflow: hidden;
  will-change: transform; }

.blog-page {
  flex-grow: 1;
  min-width: 18rem;
  padding: 1rem;
  width: calc(100% - 42rem); }
  .blog-page .post-toc {
    display: none; }
  .blog-page .post-pagination {
    width: 100%;
    height: 2rem; }
  .blog-page .post-content {
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    background-color: var(--background-color);
    color: var(--color); }
    .blog-page .post-content:hover {
      box-shadow: var(--box-shadow-hover); }

@media screen and (max-width: 70rem) {
  .flex-left .flex-visible {
    margin-bottom: 1rem; }
  .flex-left .flex-hidden {
    display: block; }
  .flex-right {
    display: none; } }

@media screen and (max-width: 48rem) {
  main {
    display: block; }
  .flex-left {
    width: 100%;
    margin: 0;
    margin-bottom: -1rem; }
    .flex-left div.outer {
      position: relative;
      width: auto; }
    .flex-left div.inner {
      width: auto; }
  .blog-page {
    width: calc(100% - 2rem); } }

@media screen and (max-width: 25rem) {
  .pagination div.pagination-box {
    margin: 0 .25rem; } }

.book-columns {
  display: flex;
  flex-wrap: wrap;
  margin: .5rem;
  margin-left: -.5rem;
  margin-right: -.5rem; }
  .book-columns .markdown-inner {
    margin: .5rem;
    flex: 1 1; }

.book-tabs {
  margin: .5em 0;
  overflow: hidden;
  display: flex;
  flex-wrap: wrap; }
  .book-tabs label {
    line-height: 1rem;
    display: inline-block;
    padding: .3rem 16px;
    border-top-left-radius: var(--border-radius);
    border-top-right-radius: var(--border-radius);
    cursor: pointer;
    z-index: 999;
    border: 1px solid transparent;
    vertical-align: baseline; }
  .book-tabs .book-tabs-content,
  .book-tabs .book-tabs-pure-content {
    order: 999;
    width: 100%;
    display: none;
    overflow: hidden;
    border-bottom-left-radius: var(--border-radius);
    border-bottom-right-radius: var(--border-radius); }
  .book-tabs .book-tabs-content {
    border: var(--border);
    padding: .5rem; }
  .book-tabs input[type="radio"] {
    display: none; }
    .book-tabs input[type="radio"]:not(:checked) + label {
      color: #95A5A6; }
      .book-tabs input[type="radio"]:not(:checked) + label:hover {
        background-color: var(--hover-color); }
    .book-tabs input[type="radio"]:checked + label {
      border: var(--border);
      border-bottom: none; }
      .book-tabs input[type="radio"]:checked + label + .book-tabs-content, .book-tabs input[type="radio"]:checked + label + .book-tabs-pure-content {
        display: block; }
    .book-tabs input[type="radio"]:first-of-type:checked + label + .book-tabs-pure-content :first-child {
      border-top-left-radius: 0; }

details {
  border: var(--border);
  border-radius: var(--border-radius);
  margin: .5rem 0;
  padding: .5rem  1rem .5rem  0.75rem; }
  details summary {
    font-size: 12.8px;
    font-weight: bold; }
    details summary::marker {
      content: '';
      font-size: 0; }
  details ::-webkit-details-marker {
    content: '';
    font-size: 0; }
  details ::-moz-list-bullet {
    content: '';
    font-size: 0; }
  details label {
    font-size: 20px !important;
    margin-left: -5px;
    margin-right: 5px;
    vertical-align: -4.5px; }
  details[open] > summary {
    margin-bottom: 0; }
    details[open] > summary label {
      transform: rotate(90deg); }
  details .markdown-inner {
    padding: .5rem 0; }
  details:focus {
    outline: none; }

article h1 {
  font-size: 200%;
  line-height: 110%; }

article h2 {
  font-size: 140%;
  line-height: 120%; }

article h3 {
  font-size: 120%;
  line-height: 120%; }
  article h3 .katex {
    font-size: 100%; }

article h4 {
  font-size: 110%; }

article p {
  margin: .5rem 0;
  line-height: 1.5rem; }

article h1, article h2, article h3, article h4, article h5, article h6 {
  margin: .7rem 0; }
  article h1 .anchor, article h2 .anchor, article h3 .anchor, article h4 .anchor, article h5 .anchor, article h6 .anchor {
    opacity: 0; }
  article h1:hover .anchor, article h1:focus .anchor, article h2:hover .anchor, article h2:focus .anchor, article h3:hover .anchor, article h3:focus .anchor, article h4:hover .anchor, article h4:focus .anchor, article h5:hover .anchor, article h5:focus .anchor, article h6:hover .anchor, article h6:focus .anchor {
    opacity: 1; }

article hr {
  border: none;
  border-bottom: 1px solid #ebeced; }

article blockquote {
  border: var(--border);
  border-radius: var(--border-radius);
  border-left: .3rem solid lightgray;
  padding: 0 .5rem; }

article pre {
  border: var(--border);
  border-radius: var(--border-radius);
  margin: .5rem 0;
  padding: .5rem 1rem;
  overflow-x: auto;
  line-height: 22px; }

article code {
  border: var(--border);
  border-radius: var(--border-radius);
  padding: 1px 2px; }

article pre {
  color: #686868; }
  article pre code {
    border: none;
    padding: 0; }
  article pre * {
    user-select: text;
    -moz-user-select: text;
    -webkit-user-select: text; }

article code:focus {
  outline: none; }

article .md__table {
  margin: -.5rem;
  padding: .5rem;
  overflow: auto; }
  article .md__table::-webkit-scrollbar-track {
    margin: .5rem; }
  article .md__table table {
    border: var(--border);
    border-radius: var(--border-radius);
    border-spacing: 0;
    overflow: auto;
    -webkit-overflow-scrolling: touch; }
    article .md__table table th {
      font-weight: normal; }
    article .md__table table td {
      border-top: 1px solid var(--border-color); }
    article .md__table table th, article .md__table table td {
      padding: .3rem 16px;
      white-space: nowrap; }

article .mermaid svg {
  display: block;
  margin: auto;
  zoom: 80%; }
</style>
  
</head>






<body>
<main>
  <div class="flex-left">
    <div class="outer">
      <div class="flex-visible">
        
  <div class="inner avatar">
  <img src="../../../images/freeze.png" class="avatar" width="96px" height="96px" />
  <h2>Net Pipe</h2>
  <div class="data-left">
    <h3>57</h3>
    <span>Posts</span>
  </div>
  <div class="data-right">
    
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
    <h3>18390</h3>
    <span>Words</span>
  </div>
  <div class="social">
    <div class="social-box">
      <img src="../../../images/search.svg"/>
      <div class="search">
        <input type="text" placeholder="Search" id="search-key" maxlength="64" data-hotkeys="s/" onkeydown="keyup_submit(event);" />
      </div>
    </div>
    <a class="alternate" href="../../../">
      <div class="social-box">
        <img src="../../../images/home.svg"/>
        <object><a href="../../../">Home</a></object>
      </div>
    </a>
    <a class="alternate" href="../../../post/">
      <div class="social-box">
        <img src="../../../images/posts.svg"/>
        <object><a href="../../../post/">Posts</a></object>
      </div>
    </a>
    <a class="alternate" type="application/rss+xml" href="../../../index.xml">
      <div class="social-box">
        <img src="../../../images/rss.svg"/>
        <object><a  type="application/rss+xml" href="../../../index.xml">RSS</a></object>
      </div>
    </a>
  </div>
  <script>
    function keyup_submit(e){ 
    var evt = window.event || e; 
      if (evt.keyCode == 13){
        window.location.href = '/_search?wd=' + document.getElementById("search-key").value;
      }
    }
  </script>
</div>
  <div class="inner categories">
  <h2><img src="../../../images/categories.svg" />Categories</h2>
  
  <span class="post-categories">
    <a href="../../../categories/%E5%9F%BA%E7%A1%80%E6%95%B0%E5%AD%A6/">基础数学</a>
  </span>
  
  <span class="post-categories">
    <a href="../../../categories/dp/">DP</a>
  </span>
  
  <span class="post-categories">
    <a href="../../../categories/%E4%BF%A1%E6%81%AF%E5%AD%A6/">信息学</a>
  </span>
  
  <span class="post-categories">
    <a href="../../../categories/%E6%95%B0%E8%AE%BA/">数论</a>
  </span>
  
  <span class="post-categories">
    <a href="../../../categories/%E7%BB%84%E5%90%88%E6%95%B0%E5%AD%A6/">组合数学</a>
  </span>
  
  <span class="post-categories">
    <a href="../../../categories/%E5%9B%BE%E8%AE%BA/">图论</a>
  </span>
  
  <span class="post-categories">
    <a href="../../../categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">数据结构</a>
  </span>
  
  <span class="post-categories">
    <a href="../../../categories/%E5%AD%97%E7%AC%A6%E4%B8%B2/">字符串</a>
  </span>
  
  <span class="post-categories">
    <a href="../../../categories/%E5%9F%BA%E7%A1%80%E7%AE%97%E6%B3%95/">基础算法</a>
  </span>
  
</div>

      </div>
      <div class="flex-hidden">
        
  <div class="inner">
  <h2><img src="../../../images/notice.svg" />Notice</h2>
  <p>Under Construction ...</p>
</div>
  

<div class="inner">
  <h2><img src="../../../images/toc.svg">TOC</h2>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#问题">问题</a></li>
    <li><a href="#构造">构造</a></li>
    <li><a href="#单点修改">单点修改</a></li>
    <li><a href="#区间查询">区间查询</a></li>
    <li><a href="#区间修改--延迟标记">区间修改 + 延迟标记</a></li>
    <li><a href="#模板">模板</a></li>
    <li><a href="#区间和线段树">区间和线段树</a></li>
    <li><a href="#权值线段树">权值线段树</a></li>
  </ul>
</nav>
</div>



      </div>
    </div>
  </div>

  
<div class="blog-page">
  <article class="post-content">
    
    <div class="post-header">
      <h1>线段树</h1>
      <span class="post-meta">
        
          <img src="../../../images/time.svg"></img>
          Apr 9, 2021
        
      </span>
      <span class="post-categories">
        
          <a href="../../../categories/%e4%bf%a1%e6%81%af%e5%ad%a6/">信息学</a>
        
          <a href="../../../categories/%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84/">数据结构</a>
        
      </span>
    </div>
    
    <h2 id="问题">问题 <a class="anchor" href="#%e9%97%ae%e9%a2%98">¶</a></h2><p>数组 $A$ 中共 $n$ 个元素，对其反复进行以下操作共 $m$ 次：</p>
<ul>
<li>
<p><strong>单点修改</strong>：将 $A[id]$ 修改为 $v$.</p>
</li>
<li>
<p><strong>区间查询</strong>：查询 $A[l\cdots r]$ 的最小值.</p>
</li>
<li>
<p><strong>区间修改</strong>：将 $A[l\cdots r]$ 每个数加上 $v$.</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00979d">int</span> <span style="color:#434f54">a</span>[];

<span style="color:#00979d">void</span> <span style="color:#d35400">set</span>(<span style="color:#00979d">int</span> <span style="color:#434f54">id</span>, <span style="color:#00979d">int</span> <span style="color:#434f54">v</span>) { <span style="color:#95a5a6">// 单点修改
</span><span style="color:#95a5a6"></span>    <span style="color:#434f54">a</span>[<span style="color:#434f54">id</span>] <span style="color:#728e00">=</span> <span style="color:#434f54">v</span>;
}

<span style="color:#00979d">int</span> <span style="color:#d35400">ask</span>(<span style="color:#00979d">int</span> <span style="color:#434f54">l</span>, <span style="color:#00979d">int</span> <span style="color:#434f54">r</span>) { <span style="color:#95a5a6">// 区间查询
</span><span style="color:#95a5a6"></span>    <span style="color:#00979d">int</span> <span style="color:#434f54">ans</span> <span style="color:#728e00">=</span> <span style="color:#8a7b52">0</span>;
    <span style="color:#728e00">for</span>(<span style="color:#00979d">int</span> <span style="color:#434f54">i</span> <span style="color:#728e00">=</span> <span style="color:#434f54">l</span>; <span style="color:#434f54">i</span> <span style="color:#728e00">&lt;=</span> <span style="color:#434f54">r</span>; <span style="color:#434f54">i</span> <span style="color:#728e00">++</span>)
        <span style="color:#434f54">ans</span> <span style="color:#728e00">=</span> <span style="color:#434f54">min</span>(<span style="color:#434f54">ans</span>, <span style="color:#434f54">a</span>[<span style="color:#434f54">i</span>]);
    <span style="color:#728e00">return</span> <span style="color:#434f54">ans</span>;
}

<span style="color:#00979d">void</span> <span style="color:#d35400">add</span>(<span style="color:#00979d">int</span> <span style="color:#434f54">l</span>, <span style="color:#00979d">int</span> <span style="color:#434f54">r</span>, <span style="color:#00979d">int</span> <span style="color:#434f54">v</span>) { <span style="color:#95a5a6">// 区间修改
</span><span style="color:#95a5a6"></span>    <span style="color:#728e00">for</span>(<span style="color:#00979d">int</span> <span style="color:#434f54">i</span> <span style="color:#728e00">=</span> <span style="color:#434f54">l</span>; <span style="color:#434f54">i</span> <span style="color:#728e00">&lt;=</span> <span style="color:#434f54">r</span>; <span style="color:#434f54">i</span> <span style="color:#728e00">++</span>)
        <span style="color:#434f54">a</span>[<span style="color:#434f54">i</span>] <span style="color:#728e00">+=</span> <span style="color:#434f54">v</span>;
}
</code></pre></div><table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">暴力算法（$\textcolor{red}{×}$）</th>
<th style="text-align:center">线段树（$\textcolor{green}{√}$）</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">单点修改</td>
<td style="text-align:center">$\textcolor{green}{O(1)}$</td>
<td style="text-align:center">$\textcolor{green}{O(\log{n})}$</td>
</tr>
<tr>
<td style="text-align:center">区间查询</td>
<td style="text-align:center">$\textcolor{red}{O(n)}$</td>
<td style="text-align:center">$\textcolor{green}{O(\log{n})}$</td>
</tr>
<tr>
<td style="text-align:center">区间修改</td>
<td style="text-align:center">$\textcolor{red}{O(n)}$</td>
<td style="text-align:center">$\textcolor{green}{O(\log{n})}$</td>
</tr>
<tr>
<td style="text-align:center">$m$ 次操作</td>
<td style="text-align:center">$\textcolor{red}{O(mn)}$</td>
<td style="text-align:center">$\textcolor{green}{O(m\log{n})}$</td>
</tr>
</tbody>
</table>
<h2 id="构造">构造 <a class="anchor" href="#%e6%9e%84%e9%80%a0">¶</a></h2><p>查询数组 $A={6,2,3,7,1,5,4,2}$ 中的最小值时，通常使用「两两比较法」：每次比较相邻两项，只保留更小的一项.比较的过程可以画成一棵二叉树，树根是答案.</p>
<p><img class="md__image" src="1.png" alt=""  /></p>
<p>这么做又有什么好处呢？假如数列中的 $1$ 被改为 $7$，你可以通过修改极少的数值，重新得出正确答案.</p>
<p><img class="md__image" src="2.png" alt=""  /></p>
<p>线段树就是这样的一颗二叉树，它的每个节点都代表一段区间中的最小值.</p>
<p>线段树具有以下性质：</p>
<ul>
<li>
<p>根节点的值为 $t[1]$，代表整个数组的最小值.</p>
</li>
<li>
<p>$t[u]$ 的左子节点为 $t[2u]$，右子节点为 $t[2u+1]$.</p>
</li>
<li>
<p>$t[u]=\min(t[2u],t[2u+1])$.</p>
</li>
</ul>
<p><img class="md__image" src="3.png" alt=""  /></p>
<p>因此，每个节点需要保存以下信息：</p>
<ul>
<li>
<p>节点的值：$val$.</p>
</li>
<li>
<p>节点代表的区间：$[l,r]$.</p>
</li>
</ul>
<p>从根节点开始，自顶向下递归构建线段树.时间复杂度为 $O(n\log{n})$.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#728e00">struct</span> <span style="color:#434f54">Node</span> {
    <span style="color:#00979d">int</span> <span style="color:#434f54">val</span>, <span style="color:#434f54">l</span>, <span style="color:#434f54">r</span>;
    <span style="color:#728e00">#define t(u) t[u].val
</span><span style="color:#728e00"></span>    <span style="color:#728e00">#define l(u) t[u].l
</span><span style="color:#728e00"></span>    <span style="color:#728e00">#define r(u) t[u].r
</span><span style="color:#728e00"></span>} <span style="color:#434f54">t</span>[];

<span style="color:#00979d">void</span> <span style="color:#d35400">build</span>(<span style="color:#00979d">int</span> <span style="color:#434f54">u</span>, <span style="color:#00979d">int</span> <span style="color:#434f54">l</span>, <span style="color:#00979d">int</span> <span style="color:#434f54">r</span>) {
    <span style="color:#434f54">l</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">=</span> <span style="color:#434f54">l</span>, <span style="color:#434f54">r</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">=</span> <span style="color:#434f54">r</span>;
    <span style="color:#728e00">if</span>(<span style="color:#434f54">l</span> <span style="color:#728e00">==</span> <span style="color:#434f54">r</span>) { <span style="color:#95a5a6">// 当前节点为叶节点
</span><span style="color:#95a5a6"></span>        <span style="color:#434f54">t</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">=</span> <span style="color:#434f54">a</span>[<span style="color:#434f54">l</span>]; <span style="color:#728e00">return</span>;
    }
    <span style="color:#00979d">int</span> <span style="color:#434f54">m</span> <span style="color:#728e00">=</span> (<span style="color:#434f54">l</span> <span style="color:#728e00">+</span> <span style="color:#434f54">r</span>) <span style="color:#728e00">/</span> <span style="color:#8a7b52">2</span>;
    <span style="color:#434f54">build</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span>, <span style="color:#434f54">l</span>, <span style="color:#434f54">m</span>);         <span style="color:#95a5a6">// 递归构建左子树
</span><span style="color:#95a5a6"></span>    <span style="color:#434f54">build</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span> <span style="color:#728e00">+</span> <span style="color:#8a7b52">1</span>, <span style="color:#434f54">m</span> <span style="color:#728e00">+</span> <span style="color:#8a7b52">1</span>, <span style="color:#434f54">r</span>); <span style="color:#95a5a6">// 递归构建右子树
</span><span style="color:#95a5a6"></span>    <span style="color:#434f54">t</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">=</span> <span style="color:#434f54">min</span>(<span style="color:#434f54">t</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span>), <span style="color:#434f54">t</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span> <span style="color:#728e00">+</span> <span style="color:#8a7b52">1</span>));
}
</code></pre></div><h2 id="单点修改">单点修改 <a class="anchor" href="#%e5%8d%95%e7%82%b9%e4%bf%ae%e6%94%b9">¶</a></h2><p>假设你要将 $A[5]$ 修改为 $3$，则 $A[5]$ 的所有祖先都有可能变动.</p>
<p><img class="md__image" src="4.png" alt=""  /></p>
<p>$set(u,id,v)$：在以节点 $u$ 为根的子树中，找到 $A[id]$，并将其更新为 $v$.</p>
<ol>
<li>
<p>令 $\su m=\frac{l(u)+r(u)}{2}$；</p>
</li>
<li>
<p>若 $id≤m$，则 $A[id]$ 在左子树中，搜索左子树；</p>
</li>
<li>
<p>若 $id&gt;m$，则 $A[id]$ 在右子树中，搜索右子树；</p>
</li>
<li>
<p>更新当前节点值：$t[u]=\min(t[2u],t[2u+1])$.</p>
</li>
</ol>
<p>时间复杂度为 $O(\log{n})$.</p>
<p>根节点是搜索的入口.执行 $set(1, id, v)$ 以进行单点修改.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00979d">void</span> <span style="color:#d35400">set</span>(<span style="color:#00979d">int</span> <span style="color:#434f54">u</span>, <span style="color:#00979d">int</span> <span style="color:#434f54">id</span>, <span style="color:#00979d">int</span> <span style="color:#434f54">v</span>) { <span style="color:#95a5a6">// 将 a[id] 改为 v
</span><span style="color:#95a5a6"></span>    <span style="color:#728e00">if</span>(<span style="color:#434f54">l</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">==</span> <span style="color:#434f54">r</span>(<span style="color:#434f54">u</span>)) { <span style="color:#95a5a6">// 叶节点
</span><span style="color:#95a5a6"></span>        <span style="color:#434f54">a</span>[<span style="color:#434f54">id</span>] <span style="color:#728e00">=</span> <span style="color:#434f54">t</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">=</span> <span style="color:#434f54">v</span>; <span style="color:#728e00">return</span>;
    }
    <span style="color:#00979d">int</span> <span style="color:#434f54">m</span> <span style="color:#728e00">=</span> (<span style="color:#434f54">l</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">+</span> <span style="color:#434f54">r</span>(<span style="color:#434f54">u</span>)) <span style="color:#728e00">/</span> <span style="color:#8a7b52">2</span>;
    <span style="color:#728e00">if</span>(<span style="color:#434f54">id</span> <span style="color:#728e00">&lt;=</span> <span style="color:#434f54">m</span>) <span style="color:#434f54">set</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span>, <span style="color:#434f54">id</span>, <span style="color:#434f54">v</span>); <span style="color:#95a5a6">// 搜索左子树
</span><span style="color:#95a5a6"></span>    <span style="color:#728e00">else</span> <span style="color:#434f54">set</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span> <span style="color:#728e00">+</span> <span style="color:#8a7b52">1</span>, <span style="color:#434f54">id</span>, <span style="color:#434f54">v</span>);    <span style="color:#95a5a6">// 搜索右子树
</span><span style="color:#95a5a6"></span>    <span style="color:#434f54">t</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">=</span> <span style="color:#434f54">min</span>(<span style="color:#434f54">t</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span>), <span style="color:#434f54">t</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span> <span style="color:#728e00">+</span> <span style="color:#8a7b52">1</span>));
}
</code></pre></div><h2 id="区间查询">区间查询 <a class="anchor" href="#%e5%8c%ba%e9%97%b4%e6%9f%a5%e8%af%a2">¶</a></h2><p>线段树中，每个节点代表一个区间.那么反过来想，每个区间都可以用若干节点表示.例如 $A[1\cdots 6]$ 可以用 $t[2]$ 和 $t[6]$ 表示，那么 $A[1\cdots 6]$ 的最小值 $=\min(t[2],t[6])=2$.</p>
<p><img class="md__image" src="5.png" alt=""  /></p>
<p>从根节点开始，自顶向下搜索出范围在 $[l,r]$ 之内的节点，这些节点的最小值即为答案.</p>
<p>$get(u,l,r)$：从节点 $u$ 开始，向下搜索 $A[l\cdots r]$ 的最小值.</p>
<ol>
<li>
<p>若 $u$ 的范围在 $[l,r]$ 之内，直接返回 $t[u]$；</p>
</li>
<li>
<p>若 $u$ 的范围与 $[l,r]$ 不重叠，返回 $∞$<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>；</p>
</li>
<li>
<p>否则递归搜索 $u$ 的两个子节点.</p>
</li>
</ol>
<p>时间复杂度为 $O(\log{n})$.执行 $get(1,l,r)$ 以进行区间查询.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00979d">int</span> <span style="color:#d35400">get</span>(<span style="color:#00979d">int</span> <span style="color:#434f54">u</span>, <span style="color:#00979d">int</span> <span style="color:#434f54">l</span>, <span style="color:#00979d">int</span> <span style="color:#434f54">r</span>) {
    <span style="color:#728e00">if</span>(<span style="color:#434f54">l</span> <span style="color:#728e00">&lt;=</span> <span style="color:#434f54">l</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">&amp;&amp;</span> <span style="color:#434f54">r</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">&lt;=</span> <span style="color:#434f54">r</span>) <span style="color:#728e00">return</span> <span style="color:#434f54">t</span>(<span style="color:#434f54">u</span>);             <span style="color:#95a5a6">// 1. 被包含
</span><span style="color:#95a5a6"></span>    <span style="color:#728e00">if</span>(<span style="color:#434f54">l</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">&gt;</span> <span style="color:#434f54">r</span> <span style="color:#728e00">||</span> <span style="color:#434f54">r</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">&lt;</span> <span style="color:#434f54">l</span>) <span style="color:#728e00">return</span> <span style="color:#8a7b52">0x3f3f3f</span>;           <span style="color:#95a5a6">// 2. 不重叠
</span><span style="color:#95a5a6"></span>    <span style="color:#728e00">return</span> <span style="color:#434f54">min</span>(<span style="color:#434f54">get</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span>, <span style="color:#434f54">l</span>, <span style="color:#434f54">r</span>), <span style="color:#434f54">get</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span> <span style="color:#728e00">+</span> <span style="color:#8a7b52">1</span>, <span style="color:#434f54">l</span>, <span style="color:#434f54">r</span>)); <span style="color:#95a5a6">// 3. 递归搜索
</span><span style="color:#95a5a6"></span>}
</code></pre></div><h2 id="区间修改--延迟标记">区间修改 + 延迟标记 <a class="anchor" href="#%e5%8c%ba%e9%97%b4%e4%bf%ae%e6%94%b9--%e5%bb%b6%e8%bf%9f%e6%a0%87%e8%ae%b0">¶</a></h2><p>如果一次性将 $A[3\cdots 8]$ 每个数加上 $v$，需要更新大量节点，时间复杂度接近 $O(n\log{n})$.这不是我们希望看到的.</p>
<p><img class="md__image" src="6.png" alt=""  /></p>
<p>事实上，大部分节点用不着马上更新——直到它们再次被访问.于是我们可以先给部分节点打标记.</p>
<p>在本例中，$t[3]$ 和 $t[5]$ 被打上了标记，这代表它们的所有子节点都还没加上 $v$.</p>
<p><img class="md__image" src="7.png" alt=""  /></p>
<p>当访问 $A[5\cdots 6]$ 时，再更新 $t[3]$ 的左子树 .$t[3]$ 的标记被下传到了它的右节点 $t[7]$.</p>
<p><img class="md__image" src="8.png" alt=""  /></p>
<p>代码与 <a href="../../../docs/NOI/DS/segtree/#%E5%8C%BA%E9%97%B4%E6%9F%A5%E8%AF%A2">区间查询</a> 类似.时间复杂度为 $O(\log{n})$.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00979d">int</span> <span style="color:#434f54">mark</span>[];

<span style="color:#00979d">void</span> <span style="color:#d35400">spread</span>(<span style="color:#00979d">int</span> <span style="color:#434f54">u</span>) { <span style="color:#95a5a6">// 更新 u 的子节点，并下传标记
</span><span style="color:#95a5a6"></span>    <span style="color:#728e00">if</span>(<span style="color:#434f54">mark</span>[<span style="color:#434f54">u</span>]) {
        <span style="color:#434f54">t</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span>) <span style="color:#728e00">+=</span> <span style="color:#434f54">mark</span>[<span style="color:#434f54">u</span>];
        <span style="color:#434f54">t</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span> <span style="color:#728e00">+</span> <span style="color:#8a7b52">1</span>) <span style="color:#728e00">+=</span> <span style="color:#434f54">mark</span>[<span style="color:#434f54">u</span>];
        <span style="color:#434f54">mark</span>[<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span>] <span style="color:#728e00">+=</span> <span style="color:#434f54">mark</span>[<span style="color:#434f54">u</span>];
        <span style="color:#434f54">mark</span>[<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span> <span style="color:#728e00">+</span> <span style="color:#8a7b52">1</span>] <span style="color:#728e00">+=</span> <span style="color:#434f54">mark</span>[<span style="color:#434f54">u</span>];
        <span style="color:#434f54">mark</span>[<span style="color:#434f54">u</span>] <span style="color:#728e00">=</span> <span style="color:#8a7b52">0</span>;
    }
}

<span style="color:#00979d">void</span> <span style="color:#d35400">add</span>(<span style="color:#00979d">int</span> <span style="color:#434f54">u</span>, <span style="color:#00979d">int</span> <span style="color:#434f54">l</span>, <span style="color:#00979d">int</span> <span style="color:#434f54">r</span>, <span style="color:#00979d">int</span> <span style="color:#434f54">v</span>) { <span style="color:#95a5a6">// 将 A[l...r] 每个数加上 v
</span><span style="color:#95a5a6"></span>    <span style="color:#728e00">if</span>(<span style="color:#434f54">l</span> <span style="color:#728e00">&lt;=</span> <span style="color:#434f54">l</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">&amp;&amp;</span> <span style="color:#434f54">r</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">&lt;=</span> <span style="color:#434f54">r</span>) { <span style="color:#95a5a6">// 完全覆盖
</span><span style="color:#95a5a6"></span>        <span style="color:#434f54">t</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">+=</span> <span style="color:#434f54">v</span>, <span style="color:#434f54">mark</span>[<span style="color:#434f54">u</span>] <span style="color:#728e00">+=</span> <span style="color:#434f54">v</span>; <span style="color:#728e00">return</span>; <span style="color:#95a5a6">// 标记
</span><span style="color:#95a5a6"></span>    } <span style="color:#728e00">else</span> <span style="color:#728e00">if</span>(<span style="color:#434f54">l</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">&gt;</span> <span style="color:#434f54">r</span> <span style="color:#728e00">||</span> <span style="color:#434f54">r</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">&lt;</span> <span style="color:#434f54">l</span>) <span style="color:#728e00">return</span>;
    <span style="color:#434f54">spread</span>(<span style="color:#434f54">u</span>); <span style="color:#95a5a6">// 下传标记
</span><span style="color:#95a5a6"></span>    <span style="color:#00979d">int</span> <span style="color:#434f54">m</span> <span style="color:#728e00">=</span> (<span style="color:#434f54">l</span> <span style="color:#728e00">+</span> <span style="color:#434f54">r</span>) <span style="color:#728e00">/</span> <span style="color:#8a7b52">2</span>;
    <span style="color:#434f54">add</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span>, <span style="color:#434f54">l</span>, <span style="color:#434f54">r</span>, <span style="color:#434f54">v</span>);
    <span style="color:#434f54">add</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span> <span style="color:#728e00">+</span> <span style="color:#8a7b52">1</span>, <span style="color:#434f54">l</span>, <span style="color:#434f54">r</span>, <span style="color:#434f54">v</span>);
    <span style="color:#434f54">t</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">=</span> <span style="color:#434f54">min</span>(<span style="color:#434f54">t</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span>), <span style="color:#434f54">t</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span> <span style="color:#728e00">+</span> <span style="color:#8a7b52">1</span>));
}
</code></pre></div><p>同时，<a href="../../../docs/NOI/DS/segtree/#%E5%8D%95%E7%82%B9%E4%BF%AE%E6%94%B9">单点修改</a> 和 <a href="../../../docs/NOI/DS/segtree/#%E5%8C%BA%E9%97%B4%E6%9F%A5%E8%AF%A2">区间查询</a> 需要添加下传标记的操作.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00979d">void</span> <span style="color:#d35400">set</span>(<span style="color:#00979d">int</span> <span style="color:#434f54">u</span>, <span style="color:#00979d">int</span> <span style="color:#434f54">id</span>, <span style="color:#00979d">int</span> <span style="color:#434f54">v</span>) {
    <span style="color:#728e00">if</span>(<span style="color:#434f54">l</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">==</span> <span style="color:#434f54">r</span>(<span style="color:#434f54">u</span>)) {
        <span style="color:#434f54">a</span>[<span style="color:#434f54">id</span>] <span style="color:#728e00">=</span> <span style="color:#434f54">t</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">=</span> <span style="color:#434f54">v</span>; <span style="color:#728e00">return</span>;
    }
    <span style="color:#434f54">spread</span>(<span style="color:#434f54">u</span>); <span style="color:#95a5a6">// 下传标记
</span><span style="color:#95a5a6"></span>    <span style="color:#00979d">int</span> <span style="color:#434f54">m</span> <span style="color:#728e00">=</span> (<span style="color:#434f54">l</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">+</span> <span style="color:#434f54">r</span>(<span style="color:#434f54">u</span>)) <span style="color:#728e00">/</span> <span style="color:#8a7b52">2</span>;
    <span style="color:#728e00">if</span>(<span style="color:#434f54">id</span> <span style="color:#728e00">&lt;=</span> <span style="color:#434f54">m</span>) <span style="color:#434f54">set</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span>, <span style="color:#434f54">id</span>, <span style="color:#434f54">v</span>);
    <span style="color:#728e00">else</span> <span style="color:#434f54">set</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span> <span style="color:#728e00">+</span> <span style="color:#8a7b52">1</span>, <span style="color:#434f54">id</span>, <span style="color:#434f54">v</span>);
    <span style="color:#434f54">t</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">=</span> <span style="color:#434f54">min</span>(<span style="color:#434f54">t</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span>), <span style="color:#434f54">t</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span> <span style="color:#728e00">+</span> <span style="color:#8a7b52">1</span>));
}

<span style="color:#00979d">int</span> <span style="color:#d35400">get</span>(<span style="color:#00979d">int</span> <span style="color:#434f54">u</span>, <span style="color:#00979d">int</span> <span style="color:#434f54">l</span>, <span style="color:#00979d">int</span> <span style="color:#434f54">r</span>) {
    <span style="color:#728e00">if</span>(<span style="color:#434f54">l</span> <span style="color:#728e00">&lt;=</span> <span style="color:#434f54">l</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">&amp;&amp;</span> <span style="color:#434f54">r</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">&lt;=</span> <span style="color:#434f54">r</span>) <span style="color:#728e00">return</span> <span style="color:#434f54">t</span>(<span style="color:#434f54">u</span>);
    <span style="color:#728e00">else</span> <span style="color:#728e00">if</span>(<span style="color:#434f54">l</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">&gt;</span> <span style="color:#434f54">r</span> <span style="color:#728e00">||</span> <span style="color:#434f54">r</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">&lt;</span> <span style="color:#434f54">l</span>) <span style="color:#728e00">return</span> <span style="color:#8a7b52">0x3f3f3f</span>;
    <span style="color:#434f54">spread</span>(<span style="color:#434f54">u</span>); <span style="color:#95a5a6">// 下传标记
</span><span style="color:#95a5a6"></span>    <span style="color:#00979d">int</span> <span style="color:#434f54">m</span> <span style="color:#728e00">=</span> (<span style="color:#434f54">l</span> <span style="color:#728e00">+</span> <span style="color:#434f54">r</span>) <span style="color:#728e00">/</span> <span style="color:#8a7b52">2</span>;
    <span style="color:#728e00">return</span> <span style="color:#434f54">min</span>(<span style="color:#434f54">get</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span>, <span style="color:#434f54">l</span>, <span style="color:#434f54">m</span>), <span style="color:#434f54">get</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span> <span style="color:#728e00">+</span> <span style="color:#8a7b52">1</span>, <span style="color:#434f54">m</span> <span style="color:#728e00">+</span> <span style="color:#8a7b52">1</span>, <span style="color:#434f54">r</span>));
}
</code></pre></div><h2 id="模板">模板 <a class="anchor" href="#%e6%a8%a1%e6%9d%bf">¶</a></h2><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#728e00">struct</span> <span style="color:#434f54">Node</span> {
    <span style="color:#00979d">int</span> <span style="color:#434f54">val</span>, <span style="color:#434f54">l</span>, <span style="color:#434f54">r</span>;
    <span style="color:#728e00">#define t(u) t[u].val
</span><span style="color:#728e00"></span>    <span style="color:#728e00">#define l(u) t[u].l
</span><span style="color:#728e00"></span>    <span style="color:#728e00">#define r(u) t[u].r
</span><span style="color:#728e00"></span>} <span style="color:#434f54">t</span>[];

<span style="color:#00979d">int</span> <span style="color:#434f54">mark</span>[];

<span style="color:#00979d">void</span> <span style="color:#d35400">build</span>(<span style="color:#00979d">int</span> <span style="color:#434f54">u</span>, <span style="color:#00979d">int</span> <span style="color:#434f54">l</span>, <span style="color:#00979d">int</span> <span style="color:#434f54">r</span>) {
    <span style="color:#434f54">l</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">=</span> <span style="color:#434f54">l</span>, <span style="color:#434f54">r</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">=</span> <span style="color:#434f54">r</span>;
    <span style="color:#728e00">if</span>(<span style="color:#434f54">l</span> <span style="color:#728e00">==</span> <span style="color:#434f54">r</span>) {
        <span style="color:#434f54">t</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">=</span> <span style="color:#434f54">a</span>[<span style="color:#434f54">l</span>]; <span style="color:#728e00">return</span>;
    }
    <span style="color:#00979d">int</span> <span style="color:#434f54">m</span> <span style="color:#728e00">=</span> (<span style="color:#434f54">l</span> <span style="color:#728e00">+</span> <span style="color:#434f54">r</span>) <span style="color:#728e00">/</span> <span style="color:#8a7b52">2</span>;
    <span style="color:#434f54">build</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span>, <span style="color:#434f54">l</span>, <span style="color:#434f54">m</span>);
    <span style="color:#434f54">build</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span> <span style="color:#728e00">+</span> <span style="color:#8a7b52">1</span>, <span style="color:#434f54">m</span> <span style="color:#728e00">+</span> <span style="color:#8a7b52">1</span>, <span style="color:#434f54">r</span>);
    <span style="color:#434f54">t</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">=</span> <span style="color:#434f54">min</span>(<span style="color:#434f54">t</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span>), <span style="color:#434f54">t</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span> <span style="color:#728e00">+</span> <span style="color:#8a7b52">1</span>));
}

<span style="color:#00979d">void</span> <span style="color:#d35400">spread</span>(<span style="color:#00979d">int</span> <span style="color:#434f54">u</span>) {
    <span style="color:#728e00">if</span>(<span style="color:#434f54">mark</span>[<span style="color:#434f54">u</span>]) {
        <span style="color:#434f54">t</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span>) <span style="color:#728e00">+=</span> <span style="color:#434f54">mark</span>[<span style="color:#434f54">u</span>];
        <span style="color:#434f54">t</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span> <span style="color:#728e00">+</span> <span style="color:#8a7b52">1</span>) <span style="color:#728e00">+=</span> <span style="color:#434f54">mark</span>[<span style="color:#434f54">u</span>];
        <span style="color:#434f54">mark</span>[<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span>] <span style="color:#728e00">+=</span> <span style="color:#434f54">mark</span>[<span style="color:#434f54">u</span>];
        <span style="color:#434f54">mark</span>[<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span> <span style="color:#728e00">+</span> <span style="color:#8a7b52">1</span>] <span style="color:#728e00">+=</span> <span style="color:#434f54">mark</span>[<span style="color:#434f54">u</span>];
        <span style="color:#434f54">mark</span>[<span style="color:#434f54">u</span>] <span style="color:#728e00">=</span> <span style="color:#8a7b52">0</span>;
    }
}

<span style="color:#00979d">void</span> <span style="color:#d35400">set</span>(<span style="color:#00979d">int</span> <span style="color:#434f54">u</span>, <span style="color:#00979d">int</span> <span style="color:#434f54">id</span>, <span style="color:#00979d">int</span> <span style="color:#434f54">v</span>) {
    <span style="color:#728e00">if</span>(<span style="color:#434f54">l</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">==</span> <span style="color:#434f54">r</span>(<span style="color:#434f54">u</span>)) {
        <span style="color:#434f54">a</span>[<span style="color:#434f54">id</span>] <span style="color:#728e00">=</span> <span style="color:#434f54">t</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">=</span> <span style="color:#434f54">v</span>; <span style="color:#728e00">return</span>;
    }
    <span style="color:#434f54">spread</span>(<span style="color:#434f54">u</span>);
    <span style="color:#00979d">int</span> <span style="color:#434f54">m</span> <span style="color:#728e00">=</span> (<span style="color:#434f54">l</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">+</span> <span style="color:#434f54">r</span>(<span style="color:#434f54">u</span>)) <span style="color:#728e00">/</span> <span style="color:#8a7b52">2</span>;
    <span style="color:#728e00">if</span>(<span style="color:#434f54">id</span> <span style="color:#728e00">&lt;=</span> <span style="color:#434f54">m</span>) <span style="color:#434f54">set</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span>, <span style="color:#434f54">id</span>, <span style="color:#434f54">v</span>);
    <span style="color:#728e00">else</span> <span style="color:#434f54">set</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span> <span style="color:#728e00">+</span> <span style="color:#8a7b52">1</span>, <span style="color:#434f54">id</span>, <span style="color:#434f54">v</span>);
    <span style="color:#434f54">t</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">=</span> <span style="color:#434f54">min</span>(<span style="color:#434f54">t</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span>), <span style="color:#434f54">t</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span> <span style="color:#728e00">+</span> <span style="color:#8a7b52">1</span>));
}

<span style="color:#00979d">int</span> <span style="color:#d35400">get</span>(<span style="color:#00979d">int</span> <span style="color:#434f54">u</span>, <span style="color:#00979d">int</span> <span style="color:#434f54">l</span>, <span style="color:#00979d">int</span> <span style="color:#434f54">r</span>) {
    <span style="color:#728e00">if</span>(<span style="color:#434f54">l</span> <span style="color:#728e00">&lt;=</span> <span style="color:#434f54">l</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">&amp;&amp;</span> <span style="color:#434f54">r</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">&lt;=</span> <span style="color:#434f54">r</span>) <span style="color:#728e00">return</span> <span style="color:#434f54">t</span>(<span style="color:#434f54">u</span>);
    <span style="color:#728e00">else</span> <span style="color:#728e00">if</span>(<span style="color:#434f54">l</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">&gt;</span> <span style="color:#434f54">r</span> <span style="color:#728e00">||</span> <span style="color:#434f54">r</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">&lt;</span> <span style="color:#434f54">l</span>) <span style="color:#728e00">return</span> <span style="color:#8a7b52">0x3f3f3f</span>;
    <span style="color:#434f54">spread</span>(<span style="color:#434f54">u</span>);
    <span style="color:#00979d">int</span> <span style="color:#434f54">m</span> <span style="color:#728e00">=</span> (<span style="color:#434f54">l</span> <span style="color:#728e00">+</span> <span style="color:#434f54">r</span>) <span style="color:#728e00">/</span> <span style="color:#8a7b52">2</span>;
    <span style="color:#728e00">return</span> <span style="color:#434f54">min</span>(<span style="color:#434f54">get</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span>, <span style="color:#434f54">l</span>, <span style="color:#434f54">m</span>), <span style="color:#434f54">get</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span> <span style="color:#728e00">+</span> <span style="color:#8a7b52">1</span>, <span style="color:#434f54">m</span> <span style="color:#728e00">+</span> <span style="color:#8a7b52">1</span>, <span style="color:#434f54">r</span>));
}

<span style="color:#00979d">void</span> <span style="color:#d35400">add</span>(<span style="color:#00979d">int</span> <span style="color:#434f54">u</span>, <span style="color:#00979d">int</span> <span style="color:#434f54">l</span>, <span style="color:#00979d">int</span> <span style="color:#434f54">r</span>, <span style="color:#00979d">int</span> <span style="color:#434f54">v</span>) {
    <span style="color:#728e00">if</span>(<span style="color:#434f54">l</span> <span style="color:#728e00">&lt;=</span> <span style="color:#434f54">l</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">&amp;&amp;</span> <span style="color:#434f54">r</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">&lt;=</span> <span style="color:#434f54">r</span>) {
        <span style="color:#434f54">t</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">+=</span> <span style="color:#434f54">v</span>, <span style="color:#434f54">mark</span>[<span style="color:#434f54">u</span>] <span style="color:#728e00">+=</span> <span style="color:#434f54">v</span>; <span style="color:#728e00">return</span>;
    } <span style="color:#728e00">else</span> <span style="color:#728e00">if</span>(<span style="color:#434f54">l</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">&gt;</span> <span style="color:#434f54">r</span> <span style="color:#728e00">||</span> <span style="color:#434f54">r</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">&lt;</span> <span style="color:#434f54">l</span>) <span style="color:#728e00">return</span>;
    <span style="color:#434f54">spread</span>(<span style="color:#434f54">u</span>);
    <span style="color:#00979d">int</span> <span style="color:#434f54">m</span> <span style="color:#728e00">=</span> (<span style="color:#434f54">l</span> <span style="color:#728e00">+</span> <span style="color:#434f54">r</span>) <span style="color:#728e00">/</span> <span style="color:#8a7b52">2</span>;
    <span style="color:#434f54">add</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span>, <span style="color:#434f54">l</span>, <span style="color:#434f54">r</span>, <span style="color:#434f54">v</span>);
    <span style="color:#434f54">add</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span> <span style="color:#728e00">+</span> <span style="color:#8a7b52">1</span>, <span style="color:#434f54">l</span>, <span style="color:#434f54">r</span>, <span style="color:#434f54">v</span>);
    <span style="color:#434f54">t</span>(<span style="color:#434f54">u</span>) <span style="color:#728e00">=</span> <span style="color:#434f54">min</span>(<span style="color:#434f54">t</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span>), <span style="color:#434f54">t</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span> <span style="color:#728e00">+</span> <span style="color:#8a7b52">1</span>));
}
</code></pre></div><h2 id="区间和线段树">区间和线段树 <a class="anchor" href="#%e5%8c%ba%e9%97%b4%e5%92%8c%e7%ba%bf%e6%ae%b5%e6%a0%91">¶</a></h2><p>线段树还可以查询区间和.</p>
<p>令每个节点代表一段区间的元素和.递推方程应为 $t[u]=t[2u]+t[2u+1]$.</p>
<p><img class="md__image" src="9.png" alt=""  /></p>
<p>若 $t[u]$ 表示区间 $[l,r]$，而 $A[l\cdots r]$ 每个数都要加上 $v$，则 $t[u]$ 需要加上 $(r-l+1)×v$.因此标记下传函数也需要调整.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00979d">void</span> <span style="color:#d35400">spread</span>(<span style="color:#00979d">int</span> <span style="color:#434f54">u</span>) {
    <span style="color:#728e00">if</span>(<span style="color:#434f54">mark</span>[<span style="color:#434f54">u</span>]) {
        <span style="color:#434f54">t</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span>) <span style="color:#728e00">+=</span> <span style="color:#434f54">mark</span>[<span style="color:#434f54">u</span>] <span style="color:#728e00">*</span> (<span style="color:#434f54">l</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span>) <span style="color:#728e00">-</span> <span style="color:#434f54">r</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span>) <span style="color:#728e00">+</span> <span style="color:#8a7b52">1</span>);
        <span style="color:#434f54">t</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span> <span style="color:#728e00">+</span> <span style="color:#8a7b52">1</span>) <span style="color:#728e00">+=</span> <span style="color:#434f54">mark</span>[<span style="color:#434f54">u</span>] <span style="color:#728e00">*</span> (<span style="color:#434f54">l</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span> <span style="color:#728e00">+</span> <span style="color:#8a7b52">1</span>) <span style="color:#728e00">-</span> <span style="color:#434f54">r</span>(<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span> <span style="color:#728e00">+</span> <span style="color:#8a7b52">1</span>) <span style="color:#728e00">+</span> <span style="color:#8a7b52">1</span>);
        <span style="color:#434f54">mark</span>[<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span>] <span style="color:#728e00">+=</span> <span style="color:#434f54">mark</span>[<span style="color:#434f54">u</span>];
        <span style="color:#434f54">mark</span>[<span style="color:#8a7b52">2</span> <span style="color:#728e00">*</span> <span style="color:#434f54">u</span> <span style="color:#728e00">+</span> <span style="color:#8a7b52">1</span>] <span style="color:#728e00">+=</span> <span style="color:#434f54">mark</span>[<span style="color:#434f54">u</span>];
        <span style="color:#434f54">mark</span>[<span style="color:#434f54">u</span>] <span style="color:#728e00">=</span> <span style="color:#8a7b52">0</span>;
    }
}
</code></pre></div><h2 id="权值线段树">权值线段树 <a class="anchor" href="#%e6%9d%83%e5%80%bc%e7%ba%bf%e6%ae%b5%e6%a0%91">¶</a></h2><p>令每个节点代表一段区间内的元素个数.下图是基于数组 $A=\{2,3,6\}$ 构建的权值线段树.$t[2]$ 代表的区间为 $[1,4]$，$t[2]=2$ 说明数组 $A$ 中有 $2$ 个元素在 $[1,4]$ 区间中，它们分别是 $2$ 和 $3$.</p>
<p><img class="md__image" src="10.png" alt=""  /></p>
<p>权值线段树可以用来做什么呢？— — 它可以求任一区间内第 $k$ 小的数.</p>
<p><img class="md__image" src="11.png" alt=""  /></p>
<blockquote class="book-hint warning">
<p>未完待续 $\cdots \ \cdots$</p>
</blockquote>

<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>$\min(∞,a)=a$，因此返回 $∞$ 相当于不参与最小值的比较.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>

  </article>
</div>



  <div class="flex-right">
    <div class="outer">
      
  <div class="inner">
  <h2><img src="../../../images/notice.svg" />Notice</h2>
  <p>Under Construction ...</p>
</div>
  

<div class="inner">
  <h2><img src="../../../images/toc.svg">TOC</h2>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#问题">问题</a></li>
    <li><a href="#构造">构造</a></li>
    <li><a href="#单点修改">单点修改</a></li>
    <li><a href="#区间查询">区间查询</a></li>
    <li><a href="#区间修改--延迟标记">区间修改 + 延迟标记</a></li>
    <li><a href="#模板">模板</a></li>
    <li><a href="#区间和线段树">区间和线段树</a></li>
    <li><a href="#权值线段树">权值线段树</a></li>
  </ul>
</nav>
</div>



    </div>
  </div>

  <script src="../../../js/jquery.min.js"></script>


<script defer>
function IsPC() {  
  var userAgentInfo = navigator.userAgent;
  var Agents = new Array("Android", "iPhone", "SymbianOS", "Windows Phone", "iPad", "iPod");  
  for (var v = 0; v < Agents.length; v ++) {  
    if (userAgentInfo.indexOf(Agents[v]) > 0) {
      return false;
    }
  }
  return true;
}
function detectZoom() {
  var ratio = 0,
  screen = window.screen,
  ua = navigator.userAgent.toLowerCase();
  if (window.devicePixelRatio !== undefined)
    ratio = window.devicePixelRatio;
  else if (~ua.indexOf('msie')) {
    if (screen.deviceXDPI && screen.logicalXDPI)
      ratio = screen.deviceXDPI / screen.logicalXDPI;
  }
  else if (window.outerWidth !== undefined && window.innerWidth !== undefined)
    ratio = window.outerWidth / window.innerWidth;
  
  if (ratio)
    ratio = Math.round(ratio * 100);
  return ratio;
}
$('img').each(function(id, el, arr) {
  if (el.parentElement.tagName == 'P') {
    el.className = "md__image";
    var src = el.getAttribute('src');
    if (IsPC() && src.substr(src.lastIndexOf(".") + 1) != "svg") {
      if (el.style.zoom)
        el.style.zoom = parseFloat(el.style.zoom) / detectZoom();
      else
        el.style.zoom = 100 / detectZoom();
    }
  }
});

















</script>





<link rel="stylesheet" href="../../../katex/katex.min.css">
<script src="../../../katex/katex.min.js"></script>
<script src="../../../katex/auto-render.min.js"></script>

<script>
  function renderTex() {
    renderMathInElement(document.body, {
      trust: true,
      delimiters: [
        { left: "$$", right: "$$", display: true },
        { left: "$", right: "$", display: false }
      ],
      macros: {
        
        "\\d": "\\text{d}",
        "\\zh": "\\footnotesize \\ ",
        "\\en": "\\normalsize \\ ",
        "\\su": "\\displaystyle",
        "\\eq": "\\Longleftrightarrow",
        "\\intro": "\\Longrightarrow",
        "\\mathring": "\\overset\{\\normalsizeₒ\}",
        "\\arccot": "\\text\{arccot\} \\, ",
        "\\xor": "\\text\{xor\} \\, ",
        "\\mex": "\\text\{mex\} \\, "
      }
    });
  }  
  document.addEventListener("DOMContentLoaded", function() {
    renderTex();
  });

</script>

<script>
  $('.language-latex').each(function(id, el, arr) {
    function toText(text) { 
      var temp = document.createElement("div"); 
      temp.innerHTML = text; 
      var output = temp.innerText || temp.textContent; 
      temp = null; 
      return output; 
    } 
    tex = toText(el.innerHTML);
    el.parentElement.outerHTML = '<div>$$' + tex + '$$</div>';
  });

</script>

<script>
  $('table').each(function(id, el, arr) {
    el.outerHTML = `<div class="md__table">${el.outerHTML}</div>`;
  });
</script>



<script src="../../../js/mermaid.min.js"></script>

<script>
  mermaid.initialize({
    
    themeCSS: ".node rect { \
      fill: transparent;    \
      stroke: transparent;  \
    }                       \
    .nodeLabel {            \
      font-size: 24px;      \
    }",
    startOnLoad: true,
    flowchart: {
      curve: 'cardinal'
    },
    securityLevel: 'loose',
  });
</script>

<script>
  Array.from(document.getElementsByClassName("language-mermaid")).forEach(
    (el) => {
      el.parentElement.outerHTML = `<div class="mermaid">${el.innerText}</div>`;
    }
  );
</script>

  
</main>
</body>
</html>