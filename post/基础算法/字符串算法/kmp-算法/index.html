<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Net Pipe&#39;s Blog</title>  
  <meta name="description" content="简介 ¶KMP 算法并不能用来看毛片，它是一">
  <meta name="author" content="Net Pipe">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href='../../../../index.xml' rel='alt' type='application/rss+xml' title='Net Pipe&#39;s Blog' />
  <link rel='shortcut icon' type='image/x-icon' href='../../../../images/NetPipe.png' />

  
  <style>* {
  --aside-width: 18rem;
  --link-color: rgb(71, 148, 211);
  --hover-color: #F6F8FA;
  --border-color: #d0d7de;
  --shadow: 0 1px 3px 0 #d4d9e1;
  --border: 1px solid var(--border-color);
  --radius: .3rem; }

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  outline: none; }

::selection {
  background-color: #CCE2FF;
  color: rgba(0, 0, 0, 0.87); }

::-webkit-scrollbar {
  width: 7px;
  height: 7px; }

::-webkit-scrollbar-thumb {
  border-radius: 10px;
  background: #f0f0f0; }
  ::-webkit-scrollbar-thumb:hover {
    background: #acacac; }

::-webkit-scrollbar-track {
  border-radius: 10px; }

a {
  text-decoration: none;
  color: var(--link-color); }

a:focus, a:hover {
  outline: none;
  text-decoration: underline; }

a.alt, a.silent {
  color: black; }

a.alt:focus,
a.alt:hover,
a.alt:focus > *,
a.alt:hover > * {
  color: var(--link-color);
  text-decoration: underline; }

a.silent:focus,
a.silent:hover,
a.silent:focus > *,
a.silent:hover > * {
  color: black;
  text-decoration: none; }

ul, ol {
  list-style: circle;
  padding-left: 1rem; }
  ul li, ol li {
    margin: .3rem 0; }

@font-face {
  font-family: 'Fantasque Sans Mono';
  src: url("/fonts/FantasqueSansMono-Regular.woff2") format("woff2"); }

@font-face {
  font-family: 'Fantasque Sans Mono';
  font-style: normal;
  font-weight: bold;
  src: url("/fonts/FantasqueSansMono-Bold.woff2") format("woff2"); }

@font-face {
  font-family: 'Fantasque Sans Mono';
  font-style: italic;
  src: url("/fonts/FantasqueSansMono-Italic.woff2") format("woff2"); }

@font-face {
  font-family: 'Fantasque Sans Mono';
  font-style: italic;
  font-weight: bold;
  src: url("/fonts/FantasqueSansMono-BoldItalic.woff2") format("woff2"); }

body, code {
  font-family: 'Fantasque Sans Mono', sans-serif; }

html, body, main {
  height: 100%;
  overflow: hidden; }

body {
  user-select: none;
  -moz-user-select: none;
  -webkit-user-select: none;
  margin: 0 auto;
  background-color: #f7f7f7; }

main {
  display: flex;
  position: relative; }

aside {
  flex: 0 0 var(--aside-width);
  padding: 2rem;
  overflow: hidden auto; }
  aside > :first-child,
  aside > :first-child > :first-child,
  aside > :first-child > :first-child > :first-child {
    margin-top: 0; }
  aside > :last-child,
  aside > :last-child > :last-child,
  aside > :last-child > :last-child > :last-child {
    margin-bottom: 0; }

article {
  flex-grow: 1;
  padding: 1rem;
  overflow: hidden auto; }
  article .post-toc {
    display: none; }

code {
  border-top: var(--border);
  border-bottom: var(--border);
  border-left: var(--border);
  border-right: var(--border);
  border-top-left-radius: var(--radius);
  border-top-right-radius: var(--radius);
  border-bottom-left-radius: var(--radius);
  border-bottom-right-radius: var(--radius);
  user-select: text;
  -moz-user-select: text;
  -webkit-user-select: text;
  padding: 1px 2px; }

.tag-card {
  border-top: var(--border);
  border-bottom: var(--border);
  border-left: var(--border);
  border-right: var(--border);
  border-top-left-radius: var(--radius);
  border-top-right-radius: var(--radius);
  border-bottom-left-radius: var(--radius);
  border-bottom-right-radius: var(--radius);
  display: inline-block;
  margin: .3rem 0;
  padding: .1rem .5rem;
  background-color: white; }
  .tag-card a {
    font-size: 13px;
    text-shadow: 0 0; }

.post-meta {
  color: gray; }
  .post-meta img {
    display: inline-block !important;
    vertical-align: text-bottom; }

#TableOfContents > ul {
  padding-left: 0; }
  #TableOfContents > ul li {
    list-style: none; }

aside.meta {
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  background-color: var(--hover-color);
  order: 1; }
  aside.meta .author {
    text-align: center; }
    aside.meta .author img {
      transition: all 0.2s;
      width: 6rem;
      height: 6rem;
      border-radius: 1rem; }
      aside.meta .author img:hover {
        transform: perspective(1px) scale(1.04); }
    aside.meta .author h2.name {
      margin: .5rem; }
  aside.meta .data {
    display: flex;
    text-align: center; }
    aside.meta .data .data-box {
      flex: 0 0 50%;
      display: inline-block; }
      aside.meta .data .data-box:first-of-type {
        border-right: 1px solid black; }
  aside.meta .social {
    margin: 1rem 0; }
    aside.meta .social .social-box {
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      transition: all 0.2s;
      margin-top: .5rem;
      padding: .4rem;
      font-size: 18px;
      background-color: white; }
      aside.meta .social .social-box:hover {
        transform: perspective(1px) scale(1.04); }
      aside.meta .social .social-box img {
        vertical-align: text-bottom;
        width: 20px;
        height: 20px;
        margin-right: .5rem; }
  aside.meta .tags h2 {
    margin: .5rem 0;
    font-size: 20px; }
    aside.meta .tags h2 img {
      width: 20px;
      height: 20px;
      vertical-align: bottom;
      margin-right: 0.5rem; }

aside.toc {
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  background-color: var(--hover-color);
  order: 3; }

article {
  order: 2; }

article.posts .post {
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding: 1rem;
  margin-bottom: 1rem;
  background-color: white; }
  article.posts .post:hover {
    background-color: var(--hover-color); }
  article.posts .post .post-title {
    font-size: 20px; }

article.posts .pagination {
  width: 100%;
  display: flex;
  flex-flow: row nowrap;
  align-items: center;
  justify-content: center;
  font-size: 18px; }
  article.posts .pagination div.pagination-box {
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    background-color: white;
    color: var(--link-color);
    margin: 0 .5rem;
    width: 2rem;
    height: 2rem;
    line-height: 2rem;
    float: left;
    text-align: center;
    vertical-align: middle;
    cursor: default; }
    article.posts .pagination div.pagination-box:not(.disabled):hover {
      background-color: var(--hover-color); }
  article.posts .pagination div.prev {
    width: 5rem;
    margin-left: 0; }
  article.posts .pagination div.next {
    width: 5rem;
    margin-right: 0; }
  article.posts .pagination div.pagination-eldivpsis {
    width: 3rem; }
  article.posts .pagination div.disabled {
    color: black; }

article.posts > :first-child,
article.posts > :first-child > :first-child,
article.posts > :first-child > :first-child > :first-child {
  margin-top: 0; }

article.posts > :last-child,
article.posts > :last-child > :last-child,
article.posts > :last-child > :last-child > :last-child {
  margin-bottom: 0; }

article.list .post-item {
  border-bottom: var(--border);
  border-radius: none;
  box-shadow: var(--shadow);
  height: 2.3rem;
  line-height: 2.3rem;
  background-color: white; }
  article.list .post-item:hover {
    background-color: var(--hover-color); }
  article.list .post-item img {
    width: 1.2rem;
    height: 1.2rem;
    margin-left: .6rem;
    vertical-align: sub; }
  article.list .post-item:first-of-type {
    border-top-left-radius: var(--radius);
    border-top-right-radius: var(--radius);
    height: 3rem;
    line-height: 3rem;
    font-size: 1.2rem;
    background-color: var(--hover-color); }
    article.list .post-item:first-of-type img {
      width: 1.4rem;
      height: 1.4rem; }
  article.list .post-item:last-of-type {
    border: none;
    border-bottom-left-radius: var(--radius);
    border-bottom-right-radius: var(--radius); }

article.markdown .content {
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  background-color: white;
  padding: 1rem; }
  article.markdown .content > :first-child,
  article.markdown .content > :first-child > :first-child,
  article.markdown .content > :first-child > :first-child > :first-child {
    margin-top: 0; }
  article.markdown .content > :last-child,
  article.markdown .content > :last-child > :last-child,
  article.markdown .content > :last-child > :last-child > :last-child {
    margin-bottom: 0; }
  article.markdown .content h1, article.markdown .content h1 .katex {
    font-size: 28px; }
  article.markdown .content h2, article.markdown .content h2 .katex {
    font-size: 24px; }
  article.markdown .content h1, article.markdown .content h2, article.markdown .content h3, article.markdown .content h4, article.markdown .content h5, article.markdown .content h6 {
    margin: .5rem 0;
    font-weight: normal; }
    article.markdown .content h1 .anchor, article.markdown .content h2 .anchor, article.markdown .content h3 .anchor, article.markdown .content h4 .anchor, article.markdown .content h5 .anchor, article.markdown .content h6 .anchor {
      opacity: 0; }
    article.markdown .content h1:hover .anchor, article.markdown .content h1:focus .anchor, article.markdown .content h2:hover .anchor, article.markdown .content h2:focus .anchor, article.markdown .content h3:hover .anchor, article.markdown .content h3:focus .anchor, article.markdown .content h4:hover .anchor, article.markdown .content h4:focus .anchor, article.markdown .content h5:hover .anchor, article.markdown .content h5:focus .anchor, article.markdown .content h6:hover .anchor, article.markdown .content h6:focus .anchor {
      opacity: 1; }
  article.markdown .content p {
    margin: .3rem 0; }
  article.markdown .content strong {
    font-weight: normal;
    text-shadow: 0 0; }
  article.markdown .content img:not(.alt) {
    display: block;
    margin: 0 auto;
    max-width: 100%; }
  article.markdown .content blockquote {
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    border-left: 0.4rem solid var(--border-color);
    margin: .5rem 0;
    padding: .5rem 1rem; }
    article.markdown .content blockquote > :first-child,
    article.markdown .content blockquote > :first-child > :first-child,
    article.markdown .content blockquote > :first-child > :first-child > :first-child {
      margin-top: 0; }
    article.markdown .content blockquote > :last-child,
    article.markdown .content blockquote > :last-child > :last-child,
    article.markdown .content blockquote > :last-child > :last-child > :last-child {
      margin-bottom: 0; }
  article.markdown .content pre {
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    user-select: text;
    -moz-user-select: text;
    -webkit-user-select: text;
    margin: .5rem 0;
    padding: .5rem 1rem;
    overflow: auto hidden;
    line-height: 1.3rem; }
    article.markdown .content pre code {
      border: none;
      padding: 0; }
  article.markdown .content table {
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    margin: .5rem 0;
    overflow: auto;
    border-spacing: 0;
    -webkit-overflow-scrolling: touch; }
    article.markdown .content table tr:hover {
      background-color: var(--hover-color); }
    article.markdown .content table th, article.markdown .content table td {
      padding: .3rem 16px;
      font-weight: normal; }
    article.markdown .content table td {
      border-top: var(--border); }

@media screen and (max-width: 65rem) {
  aside.toc {
    display: none; }
  article .post-toc {
    display: block !important; } }

@media screen and (max-width: 40rem) {
  main {
    display: block;
    overflow: auto; }
  aside {
    border: none !important; } }

.book-columns {
  display: flex;
  flex-wrap: wrap;
  margin: .5rem;
  margin-left: -.5rem;
  margin-right: -.5rem; }
  .book-columns .markdown-inner {
    margin: .5rem;
    flex: 1 1; }

.book-tabs {
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  margin: .5em 0;
  overflow: hidden;
  display: flex;
  flex-wrap: wrap; }
  .book-tabs label {
    height: 2rem;
    line-height: 2rem;
    display: inline-block;
    padding: 0 .5rem;
    min-width: 2.5rem;
    cursor: pointer;
    z-index: 999;
    text-align: center; }
  .book-tabs .book-tabs-content {
    border-top: var(--border);
    border-bottom-left-radius: var(--radius);
    border-bottom-right-radius: var(--radius);
    border-top: var(--border);
    padding: .5rem;
    order: 999;
    width: 100%;
    display: none;
    overflow: hidden; }
    .book-tabs .book-tabs-content > :first-child,
    .book-tabs .book-tabs-content > :first-child > :first-child,
    .book-tabs .book-tabs-content > :first-child > :first-child > :first-child {
      margin-top: 0; }
    .book-tabs .book-tabs-content > :last-child,
    .book-tabs .book-tabs-content > :last-child > :last-child,
    .book-tabs .book-tabs-content > :last-child > :last-child > :last-child {
      margin-bottom: 0; }
  .book-tabs input[type="radio"] {
    display: none; }
    .book-tabs input[type="radio"]:not(:checked) + label {
      color: var(--border-color); }
      .book-tabs input[type="radio"]:not(:checked) + label:hover {
        background-color: var(--hover-color); }
    .book-tabs input[type="radio"]:checked + label {
      background-color: var(--hover-color); }
      .book-tabs input[type="radio"]:checked + label + .book-tabs-content {
        display: block; }

details {
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  margin: .5rem 0;
  padding: .5rem;
  background-color: var(--hover-color); }
  details summary {
    font-size: 14px;
    text-shadow: 0 0; }
    details summary::marker {
      content: '';
      font-size: 0; }
    details summary img.alt {
      width: 18px;
      height: 18px;
      margin-right: .2rem;
      vertical-align: sub;
      transition: .2s all; }
  details ::-webkit-details-marker,
  details ::-moz-list-bullet {
    content: '';
    font-size: 0; }
  details[open] > summary {
    margin-bottom: 0; }
    details[open] > summary img.alt {
      transform: rotate(90deg); }
  details .markdown-inner {
    border-top: var(--border);
    border-bottom: var(--border);
    border-left: var(--border);
    border-right: var(--border);
    border-top-left-radius: var(--radius);
    border-top-right-radius: var(--radius);
    border-bottom-left-radius: var(--radius);
    border-bottom-right-radius: var(--radius);
    margin-top: .5rem;
    padding: .5rem;
    background-color: white; }
    details .markdown-inner > :first-child,
    details .markdown-inner > :first-child > :first-child,
    details .markdown-inner > :first-child > :first-child > :first-child {
      margin-top: 0; }
    details .markdown-inner > :last-child,
    details .markdown-inner > :last-child > :last-child,
    details .markdown-inner > :last-child > :last-child > :last-child {
      margin-bottom: 0; }
  details:focus {
    outline: none; }
</style>
  
</head>

<body>
  <main>
  
<aside class='meta'>
  <div class='author'>
    <a href="../../../../"><img src='../../../../images/NetPipe.png'></a>
    <h2 class='name'>Net Pipe</h2>
  </div>

  <div class="data">
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
    <div class='data-box'>
      <h3>59</h3>
      <span>Posts</span>
    </div>
    <div class='data-box'>
      <h3>56327</h3>
      <span>Words</span>
    </div>
  </div>

  <div class="social">
    <a class="silent" href="../../../../">
      <div class="social-box"><img src="../../../../images/home.svg"/><span>Home</span></div>
    </a>
    <a class="silent" href="../../../../post/">
      <div class="social-box"><img src="../../../../images/posts.svg"/><span>Posts</span></div>
    </a>
    <a class="silent" type="application/rss+xml" href="../../../../index.xml">
      <div class="social-box"><img src="../../../../images/rss.svg"/><span>RSS</span></div>
    </a>
  </div>

  <div class="tags">
    <h2><img src="../../../../images/categories.svg" />Tags</h2>
    
    <div class="tag-card">
      <a class="silent" href="../../../../categories/%E5%9F%BA%E7%A1%80%E6%95%B0%E5%AD%A6/">基础数学</a>
    </div>
    
    <div class="tag-card">
      <a class="silent" href="../../../../categories/dp/">DP</a>
    </div>
    
    <div class="tag-card">
      <a class="silent" href="../../../../categories/%E4%BF%A1%E6%81%AF%E5%AD%A6/">信息学</a>
    </div>
    
    <div class="tag-card">
      <a class="silent" href="../../../../categories/%E6%95%B0%E8%AE%BA/">数论</a>
    </div>
    
    <div class="tag-card">
      <a class="silent" href="../../../../categories/%E7%BB%84%E5%90%88%E6%95%B0%E5%AD%A6/">组合数学</a>
    </div>
    
    <div class="tag-card">
      <a class="silent" href="../../../../categories/%E5%9B%BE%E8%AE%BA/">图论</a>
    </div>
    
    <div class="tag-card">
      <a class="silent" href="../../../../categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">数据结构</a>
    </div>
    
    <div class="tag-card">
      <a class="silent" href="../../../../categories/%E5%AD%97%E7%AC%A6%E4%B8%B2/">字符串</a>
    </div>
    
    <div class="tag-card">
      <a class="silent" href="../../../../categories/%E5%9F%BA%E7%A1%80%E7%AE%97%E6%B3%95/">基础算法</a>
    </div>
    
  </div>
</aside>

<aside class='toc'>
  <h2>TOC</h2>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#简介">简介</a></li>
    <li><a href="#问题">问题</a></li>
    <li><a href="#原理">原理</a></li>
    <li><a href="#预处理">预处理</a></li>
    <li><a href="#模板">模板</a></li>
  </ul>
</nav>
</aside>


  
<article class='markdown'>
<div class='content'>
  
  <h1>KMP 算法</h1>
  
  <span class="post-meta">
    
    <img class='alt' src="../../../../images/time.svg"></img>
    May 28, 2021
    
  </span>

  
  <div class='tag-card'>
    <a class='silent' href="../../../../categories/%e4%bf%a1%e6%81%af%e5%ad%a6/">信息学</a>
  </div>
  
  <div class='tag-card'>
    <a class='silent' href="../../../../categories/%e5%ad%97%e7%ac%a6%e4%b8%b2/">字符串</a>
  </div>
  

  
  <div class='post-toc'>
    <h2>TOC</h2>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#简介">简介</a></li>
    <li><a href="#问题">问题</a></li>
    <li><a href="#原理">原理</a></li>
    <li><a href="#预处理">预处理</a></li>
    <li><a href="#模板">模板</a></li>
  </ul>
</nav>
  </div>
  

  <h2 id="简介">简介 <a class="anchor" href="#%e7%ae%80%e4%bb%8b">¶</a></h2><p><code>KMP</code> 算法并不能用来看毛片，它是一种字符串匹配算法.<code>KMP</code> 是该算法的发明者 <code>Kruth</code>，<code>Morris</code> 和 <code>Pratt</code> 的名字缩写.</p>
<p><img class="md__image" src="1.png" alt=""  /></p>
<h2 id="问题">问题 <a class="anchor" href="#%e9%97%ae%e9%a2%98">¶</a></h2><p>给定字符串 $A$（长度为 $m$）和 $B$（长度为 $n$），问 $A$ 中是否包含 $B$ ？</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A<span style="color:#728e00">&amp;</span>=a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>c<span style="color:#728e00">\\</span>
B<span style="color:#728e00">&amp;</span>=a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>c
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div><p>考虑暴力算法：</p>
<ul>
<li>先将 $A$ 和 $B$ 左端对齐.</li>
<li>如果匹配失败，就将 $B$ 右移一位，直到匹配成功.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>red<span style="color:#728e00">}{</span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a<span style="color:#728e00">}</span> <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>c<span style="color:#728e00">\\</span>
B<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>red<span style="color:#728e00">}{</span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>c<span style="color:#728e00">}</span>
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A=a <span style="color:#728e00">\ </span><span style="color:#728e00">&amp;</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>red<span style="color:#728e00">}{</span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b<span style="color:#728e00">}</span> <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>c<span style="color:#728e00">\\</span>
B=<span style="color:#728e00">\;</span><span style="color:#728e00">&amp;</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>red<span style="color:#728e00">}{</span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>c<span style="color:#728e00">}</span>
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A=a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span><span style="color:#728e00">&amp;</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>red<span style="color:#728e00">}{</span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a<span style="color:#728e00">}</span> <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>c<span style="color:#728e00">\\</span>
B=<span style="color:#728e00">\;</span><span style="color:#728e00">&amp;</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>red<span style="color:#728e00">}{</span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>c<span style="color:#728e00">}</span>
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A=a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span><span style="color:#728e00">&amp;</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>red<span style="color:#728e00">}{</span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b<span style="color:#728e00">}</span> <span style="color:#728e00">\ </span>c<span style="color:#728e00">\\</span>
B=<span style="color:#728e00">\;</span><span style="color:#728e00">&amp;</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>red<span style="color:#728e00">}{</span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>c<span style="color:#728e00">}</span>
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A=a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span><span style="color:#728e00">&amp;</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>c<span style="color:#728e00">}</span><span style="color:#728e00">\\</span>
B=<span style="color:#728e00">\;</span><span style="color:#728e00">&amp;</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>c<span style="color:#728e00">}</span>
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div><p>时间复杂度：$O(mn)$.</p>
<blockquote class="book-hint warning">
<p>本章统一使用<font color=red>红色</font>表示不匹配，<font color=green>绿色</font>表示匹配.</p>
</blockquote>

<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00979d">bool</span> <span style="color:#d35400">match</span>(<span style="color:#434f54">string</span> <span style="color:#434f54">a</span>, <span style="color:#434f54">string</span> <span style="color:#434f54">b</span>) {
    <span style="color:#00979d">int</span> <span style="color:#434f54">m</span> <span style="color:#728e00">=</span> <span style="color:#434f54">a</span>.<span style="color:#434f54">size</span>(), <span style="color:#434f54">n</span> <span style="color:#728e00">=</span> <span style="color:#434f54">b</span>.<span style="color:#434f54">size</span>();
    <span style="color:#00979d">int</span> <span style="color:#434f54">i</span> <span style="color:#728e00">=</span> <span style="color:#8a7b52">0</span>, <span style="color:#434f54">j</span> <span style="color:#728e00">=</span> <span style="color:#8a7b52">0</span>;
    <span style="color:#728e00">while</span>(<span style="color:#434f54">i</span> <span style="color:#728e00">&lt;</span> <span style="color:#434f54">m</span>) {
        <span style="color:#728e00">while</span>(<span style="color:#434f54">j</span> <span style="color:#728e00">&lt;</span> <span style="color:#434f54">n</span> <span style="color:#728e00">&amp;&amp;</span> <span style="color:#434f54">a</span>[<span style="color:#434f54">i</span>] <span style="color:#728e00">==</span> <span style="color:#434f54">b</span>[<span style="color:#434f54">j</span>]) <span style="color:#434f54">j</span> <span style="color:#728e00">++</span>;
        <span style="color:#728e00">if</span>(<span style="color:#434f54">j</span> <span style="color:#728e00">==</span> <span style="color:#434f54">n</span>) <span style="color:#728e00">return</span> <span style="color:#728e00">true</span>;
        <span style="color:#434f54">i</span> <span style="color:#728e00">++</span>, <span style="color:#434f54">j</span> <span style="color:#728e00">=</span> <span style="color:#8a7b52">0</span>;
    }
    <span style="color:#728e00">return</span> <span style="color:#728e00">false</span>;
}
</code></pre></div><h2 id="原理">原理 <a class="anchor" href="#%e5%8e%9f%e7%90%86">¶</a></h2><p>当匹配失败时，我们忽视了一些重要的信息.当第一次匹配失败时，两个绿串相等.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b<span style="color:#728e00">}</span> <span style="color:#728e00">\ \textcolor</span><span style="color:#728e00">{</span>red<span style="color:#728e00">}{</span>a<span style="color:#728e00">}</span> <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>c<span style="color:#728e00">\\</span>
B<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b<span style="color:#728e00">}</span> <span style="color:#728e00">\ \textcolor</span><span style="color:#728e00">{</span>red<span style="color:#728e00">}{</span>c<span style="color:#728e00">}</span>
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div><p>该绿串还有着相同的前缀<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>和后缀.我们管它叫做「公共前后缀」.$abab$ 的公共前后缀为 $ab$.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\underset</span><span style="color:#728e00">{</span>前缀<span style="color:#728e00">}{</span><span style="color:#728e00">\underline</span><span style="color:#728e00">{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>a <span style="color:#728e00">\ </span>b<span style="color:#728e00">}}}</span> <span style="color:#728e00">\ \underset</span><span style="color:#728e00">{</span>后缀<span style="color:#728e00">}{</span><span style="color:#728e00">\underline</span><span style="color:#728e00">{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>a <span style="color:#728e00">\ </span>b<span style="color:#728e00">}}}</span>
</code></pre></div><p>从下面这个角度看，$A$ 和 $B$ 划线的两段，都是公共前后缀，它们相等.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A<span style="color:#728e00">&amp;</span>=a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ \underline</span><span style="color:#728e00">{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>a <span style="color:#728e00">\ </span>b<span style="color:#728e00">}}</span> <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>c<span style="color:#728e00">\\</span>
B<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\underline</span><span style="color:#728e00">{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>a <span style="color:#728e00">\ </span>b<span style="color:#728e00">}}</span> <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>c
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div><p>若 $B$ 右移后能与 $A$ 匹配，那么 $B$ 至少要右移 $2$ 位，也就是使相等的两段对齐.这样就避免了一位一位地移，从而提高效率.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A=a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span><span style="color:#728e00">&amp;</span><span style="color:#728e00">\underline</span><span style="color:#728e00">{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>a <span style="color:#728e00">\ </span>b<span style="color:#728e00">}}</span> <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>c<span style="color:#728e00">\\</span>
B=<span style="color:#728e00">\;</span><span style="color:#728e00">&amp;</span><span style="color:#728e00">\underline</span><span style="color:#728e00">{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>a <span style="color:#728e00">\ </span>b<span style="color:#728e00">}}</span> <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>c
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div><p>到此为止，<code>KMP</code> 的思路已经很明朗了.</p>





<div class="book-tabs"><input type="radio" class="toggle" name="tabs-0" id="tabs-0-0" checked="checked" />
  <label for="tabs-0-0">1</label>
  <div class="book-tabs-content"><p>将 $A$ 串和 $B$ 串左端对齐（$σ$ 表示不定字符）.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A <span style="color:#728e00">&amp;</span>= σσσσσσσσσσσσ<span style="color:#728e00">\\</span>
B <span style="color:#728e00">&amp;</span>= σσσσσσσ
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div></div><input type="radio" class="toggle" name="tabs-0" id="tabs-0-1"  />
  <label for="tabs-0-1">2</label>
  <div class="book-tabs-content"><p>从左往右比较字符，直到不匹配.此时 $A$ 和 $B$ 的绿串相等.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A <span style="color:#728e00">&amp;</span>= <span style="color:#728e00">\color</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>σσσσσ<span style="color:#728e00">}</span><span style="color:#728e00">\color</span><span style="color:#728e00">{</span>red<span style="color:#728e00">}</span>σ<span style="color:#728e00">\color</span><span style="color:#728e00">{</span>black<span style="color:#728e00">}</span>σσσσσσ<span style="color:#728e00">\\</span>
B <span style="color:#728e00">&amp;</span>= <span style="color:#728e00">\color</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>σσσσσ<span style="color:#728e00">}</span><span style="color:#728e00">\color</span><span style="color:#728e00">{</span>red<span style="color:#728e00">}</span>σ<span style="color:#728e00">\color</span><span style="color:#728e00">{</span>black<span style="color:#728e00">}</span>σ
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div></div><input type="radio" class="toggle" name="tabs-0" id="tabs-0-2"  />
  <label for="tabs-0-2">3</label>
  <div class="book-tabs-content"><p>在绿串中找出相同的前缀和后缀（公共前后缀）.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A <span style="color:#728e00">&amp;</span>= <span style="color:#728e00">\color</span><span style="color:#728e00">{</span>lightgreen<span style="color:#728e00">}{</span>σσσ<span style="color:#728e00">}</span><span style="color:#728e00">\color</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span><span style="color:#728e00">\underline</span><span style="color:#728e00">{</span>σσ<span style="color:#728e00">}}</span><span style="color:#728e00">\color</span><span style="color:#728e00">{</span>black<span style="color:#728e00">}</span>σσσσσσσ<span style="color:#728e00">\\</span>
B <span style="color:#728e00">&amp;</span>= <span style="color:#728e00">\color</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span><span style="color:#728e00">\underline</span><span style="color:#728e00">{</span>σσ<span style="color:#728e00">}}</span><span style="color:#728e00">\color</span><span style="color:#728e00">{</span>lightgreen<span style="color:#728e00">}{</span>σσσ<span style="color:#728e00">}</span><span style="color:#728e00">\color</span><span style="color:#728e00">{</span>black<span style="color:#728e00">}</span>σσ
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div></div><input type="radio" class="toggle" name="tabs-0" id="tabs-0-3"  />
  <label for="tabs-0-3">4</label>
  <div class="book-tabs-content"><p>右移 $B$ 串，直到前缀和后缀竖直对齐.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A = <span style="color:#728e00">\color</span><span style="color:#728e00">{</span>lightgreen<span style="color:#728e00">}{</span>σσσ<span style="color:#728e00">}&amp;</span><span style="color:#728e00">\color</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span><span style="color:#728e00">\underline</span><span style="color:#728e00">{</span>σσ<span style="color:#728e00">}}</span><span style="color:#728e00">\color</span><span style="color:#728e00">{</span>black<span style="color:#728e00">}</span>σσσσσσσ<span style="color:#728e00">\\</span>
B = <span style="color:#728e00">\;</span><span style="color:#728e00">&amp;</span><span style="color:#728e00">\color</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span><span style="color:#728e00">\underline</span><span style="color:#728e00">{</span>σσ<span style="color:#728e00">}}</span><span style="color:#728e00">\color</span><span style="color:#728e00">{</span>lightgreen<span style="color:#728e00">}{</span>σσσ<span style="color:#728e00">}</span><span style="color:#728e00">\color</span><span style="color:#728e00">{</span>black<span style="color:#728e00">}</span>σσ
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div></div><input type="radio" class="toggle" name="tabs-0" id="tabs-0-4"  />
  <label for="tabs-0-4">5</label>
  <div class="book-tabs-content"><p>从对齐部分的后一个字符开始，继续向右匹配，重复前面的过程.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A = σσσ<span style="color:#728e00">&amp;</span><span style="color:#728e00">\color</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span><span style="color:#728e00">\underline</span><span style="color:#728e00">{</span>σσ<span style="color:#728e00">}}</span><span style="color:#728e00">\color</span><span style="color:#728e00">{</span>goldenrod<span style="color:#728e00">}</span>σ<span style="color:#728e00">\color</span><span style="color:#728e00">{</span>black<span style="color:#728e00">}</span>σσσσσσ<span style="color:#728e00">\\</span>
B = <span style="color:#728e00">\;</span><span style="color:#728e00">&amp;</span><span style="color:#728e00">\color</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span><span style="color:#728e00">\underline</span><span style="color:#728e00">{</span>σσ<span style="color:#728e00">}}</span><span style="color:#728e00">\color</span><span style="color:#728e00">{</span>goldenrod<span style="color:#728e00">}</span>σ<span style="color:#728e00">\color</span><span style="color:#728e00">{</span>black<span style="color:#728e00">}</span>σσσσ
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div></div></div>

<p>现在还有一个问题：在程序中，如何实现字符串的右移？$——$ 使用指针.</p>
<p>指针 $i,j$ 分别指向 $A$ 串和 $B$ 串，表示 $A[i]$ 和 $B[j]$ 前的两个绿串匹配.如果将 $B$ 串右移 $x$ 位，那么在程序中，只需要将 $j$ 指针左移 $x$ 位.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>σσσσσ<span style="color:#728e00">}</span><span style="color:#728e00">\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> i<span style="color:#728e00">}{</span>↓<span style="color:#728e00">}}{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>red<span style="color:#728e00">}{</span>σ<span style="color:#728e00">}}</span>σσσσσσ<span style="color:#728e00">\\</span>
B<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>σσσσσ<span style="color:#728e00">}</span><span style="color:#728e00">\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> j<span style="color:#728e00">}{</span>↑<span style="color:#728e00">}}{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>red<span style="color:#728e00">}{</span>σ<span style="color:#728e00">}}</span>σ
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A=σσσ<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>σσ<span style="color:#728e00">}</span><span style="color:#728e00">\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> i<span style="color:#728e00">}{</span>↓<span style="color:#728e00">}}{</span>σ<span style="color:#728e00">}&amp;</span>σσσσσσ<span style="color:#728e00">\\</span>
B=<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>σσ<span style="color:#728e00">}</span><span style="color:#728e00">\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> j<span style="color:#728e00">}{</span>↑<span style="color:#728e00">}}{</span>σ<span style="color:#728e00">}&amp;</span>σσσσ
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div><p>$pre[i]$ 表示 $B[0\cdots i]$ 的公共前后缀长度，$pre[ \ ]$ 具体怎么预处理后续会说.现在假设 $pre[ \ ]$ 数组已经处理好了.依照刚才的思路，<code>KMP</code> 的主程序可以分解为以下步骤（结合下面的样例理解）：</p>
<ol>
<li>
<p>令 $i,j$ 分别指向 $A$ 和 $B$ 的开头，即 $i=0,j=0$.</p>
</li>
<li>
<p>如果 $A[i]=B[j]$，$i$ 和 $j$ 同时右移一位.</p>
</li>
<li>
<p>如果 $A[i]≠B[j]$，又分两种情况讨论：</p>
<ul>
<li>
<p>$j≠0$ 时，绿串的公共前后缀长度为 $pre[j-1]$.那么就令 $j=pre[j-1]$.</p>
</li>
<li>
<p>$j=0$ 时，$j$ 不能再往左移.此时只能将 $i$ 右移一位.</p>
</li>
</ul>
</li>
<li>
<p>重复 2、3 两个步骤，直到匹配完成.</p>
</li>
</ol>





<div class="book-tabs"><input type="radio" class="toggle" name="tabs-1" id="tabs-1-0" checked="checked" />
  <label for="tabs-1-0">1</label>
  <div class="book-tabs-content"><p>令指针 $i$ 和 $j$ 分别指向 $A$ 串和 $B$ 串的开头.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> i<span style="color:#728e00">}{</span>↓<span style="color:#728e00">}}{</span>a<span style="color:#728e00">}</span>bababc<span style="color:#728e00">\\</span>
B<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> j<span style="color:#728e00">}{</span>↑<span style="color:#728e00">}}{</span>a<span style="color:#728e00">}</span>babc
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div></div><input type="radio" class="toggle" name="tabs-1" id="tabs-1-1"  />
  <label for="tabs-1-1">2</label>
  <div class="book-tabs-content"><p>$A[i]=B[i]$，$i$ 和 $j$ 同时右移一位.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> i<span style="color:#728e00">}{</span>↓<span style="color:#728e00">}}{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>a<span style="color:#728e00">}}</span>bababc<span style="color:#728e00">\\</span>
B<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> j<span style="color:#728e00">}{</span>↑<span style="color:#728e00">}}{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>a<span style="color:#728e00">}}</span>babc
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div></div><input type="radio" class="toggle" name="tabs-1" id="tabs-1-2"  />
  <label for="tabs-1-2">3</label>
  <div class="book-tabs-content"><p>$A[i]=B[j]$，$i$ 和 $j$ 同时右移一位.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> i<span style="color:#728e00">}{</span>↓<span style="color:#728e00">}}{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}</span>a<span style="color:#728e00">}</span>babc<span style="color:#728e00">\\</span>
B<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> j<span style="color:#728e00">}{</span>↑<span style="color:#728e00">}}{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}</span>a<span style="color:#728e00">}</span>bc
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div></div><input type="radio" class="toggle" name="tabs-1" id="tabs-1-3"  />
  <label for="tabs-1-3">4</label>
  <div class="book-tabs-content"><p>$A[i]=B[j]$，$i$ 和 $j$ 同时右移一位.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}</span><span style="color:#728e00">\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> i<span style="color:#728e00">}{</span>↓<span style="color:#728e00">}}{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>a<span style="color:#728e00">}}</span>babc<span style="color:#728e00">\\</span>
B<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}</span><span style="color:#728e00">\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> j<span style="color:#728e00">}{</span>↑<span style="color:#728e00">}}{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>a<span style="color:#728e00">}}</span>bc
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div></div><input type="radio" class="toggle" name="tabs-1" id="tabs-1-4"  />
  <label for="tabs-1-4">5</label>
  <div class="book-tabs-content"><p>$A[i]=B[j]$，$i$ 和 $j$ 同时右移一位.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}</span><span style="color:#728e00">\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> i<span style="color:#728e00">}{</span>↓<span style="color:#728e00">}}{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}</span>a<span style="color:#728e00">}</span>bc<span style="color:#728e00">\\</span>
B<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}</span><span style="color:#728e00">\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> j<span style="color:#728e00">}{</span>↑<span style="color:#728e00">}}{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}</span>c<span style="color:#728e00">}</span>
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div></div><input type="radio" class="toggle" name="tabs-1" id="tabs-1-5"  />
  <label for="tabs-1-5">6</label>
  <div class="book-tabs-content"><p>$A[i]≠B[j]$，令 $j=pre[j-1]=2$.这样，$A[i]$ 和 $B[j]$ 前的绿串就又匹配了.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>lightgreen<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}</span><span style="color:#728e00">\underline</span><span style="color:#728e00">{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}}</span><span style="color:#728e00">\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> i<span style="color:#728e00">}{</span>↓<span style="color:#728e00">}}{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>red<span style="color:#728e00">}{</span>a<span style="color:#728e00">}}</span>bc<span style="color:#728e00">\\</span>
B<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\underline</span><span style="color:#728e00">{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}}</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>lightgreen<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}</span><span style="color:#728e00">\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> j<span style="color:#728e00">}{</span>↑<span style="color:#728e00">}}{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>red<span style="color:#728e00">}{</span>c<span style="color:#728e00">}}</span>
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A<span style="color:#728e00">&amp;</span>=ab<span style="color:#728e00">\underline</span><span style="color:#728e00">{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}}</span><span style="color:#728e00">\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> i<span style="color:#728e00">}{</span>↓<span style="color:#728e00">}}{</span>a<span style="color:#728e00">}</span>bc<span style="color:#728e00">\\</span>
B<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\underline</span><span style="color:#728e00">{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}}</span><span style="color:#728e00">\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> j<span style="color:#728e00">}{</span>↑<span style="color:#728e00">}}{</span>a<span style="color:#728e00">}</span>bc
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div><blockquote class="book-hint warning">
<p>字符串的下标是从 $0$ 开始计算的.$j=2$ 实际上就是将 $j$ 指向 $B$ 串的第 $3$ 个字符.</p>
</blockquote>
</div><input type="radio" class="toggle" name="tabs-1" id="tabs-1-6"  />
  <label for="tabs-1-6">7</label>
  <div class="book-tabs-content"><p>$A[i]=B[j]$，$i$ 和 $j$ 同时右移一位.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A<span style="color:#728e00">&amp;</span>=ab<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}</span><span style="color:#728e00">\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> i<span style="color:#728e00">}{</span>↓<span style="color:#728e00">}}{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>a<span style="color:#728e00">}}</span>bc<span style="color:#728e00">\\</span>
B<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}</span><span style="color:#728e00">\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> j<span style="color:#728e00">}{</span>↑<span style="color:#728e00">}}{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>a<span style="color:#728e00">}}</span>bc
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div></div><input type="radio" class="toggle" name="tabs-1" id="tabs-1-7"  />
  <label for="tabs-1-7">8</label>
  <div class="book-tabs-content"><p>$A[i]=B[j]$，$i$ 和 $j$ 同时右移一位.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A<span style="color:#728e00">&amp;</span>=ab<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}</span><span style="color:#728e00">\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> i<span style="color:#728e00">}{</span>↓<span style="color:#728e00">}}{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}</span>c<span style="color:#728e00">}</span><span style="color:#728e00">\\</span>
B<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}</span><span style="color:#728e00">\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> j<span style="color:#728e00">}{</span>↑<span style="color:#728e00">}}{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}</span>c<span style="color:#728e00">}</span>
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div></div><input type="radio" class="toggle" name="tabs-1" id="tabs-1-8"  />
  <label for="tabs-1-8">9</label>
  <div class="book-tabs-content"><p>$A[i]=B[j]$，$i$ 和 $j$ 同时右移一位.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A<span style="color:#728e00">&amp;</span>=ab<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>abab<span style="color:#728e00">}</span><span style="color:#728e00">\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> i<span style="color:#728e00">}{</span>↓<span style="color:#728e00">}}{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>c<span style="color:#728e00">}}</span><span style="color:#728e00">\\</span>
B<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>abab<span style="color:#728e00">}</span><span style="color:#728e00">\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> j<span style="color:#728e00">}{</span>↑<span style="color:#728e00">}}{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>c<span style="color:#728e00">}}</span>
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div><p>此时 $j=B\;$串长度 $ =5$，指到了 $B$ 串外面，代表匹配成功.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A<span style="color:#728e00">&amp;</span>=ab<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ababc<span style="color:#728e00">}</span><span style="color:#728e00">\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> i<span style="color:#728e00">}{</span>↓<span style="color:#728e00">}}{</span><span style="color:#728e00">\color</span><span style="color:#728e00">{</span>white<span style="color:#728e00">}{</span>b<span style="color:#728e00">}}</span><span style="color:#728e00">\\</span>
B<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ababc<span style="color:#728e00">}</span><span style="color:#728e00">\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> j<span style="color:#728e00">}{</span>↑<span style="color:#728e00">}}{</span><span style="color:#728e00">\color</span><span style="color:#728e00">{</span>white<span style="color:#728e00">}{</span>b<span style="color:#728e00">}}</span>
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div></div></div>

<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00979d">int</span> <span style="color:#434f54">pre</span>[];

<span style="color:#00979d">bool</span> <span style="color:#d35400">kmp</span>(<span style="color:#434f54">string</span> <span style="color:#434f54">A</span>, <span style="color:#434f54">string</span> <span style="color:#434f54">B</span>) {
	<span style="color:#00979d">int</span> <span style="color:#434f54">i</span> <span style="color:#728e00">=</span> <span style="color:#8a7b52">0</span>, <span style="color:#434f54">j</span> <span style="color:#728e00">=</span> <span style="color:#8a7b52">0</span>;
	<span style="color:#728e00">while</span>(<span style="color:#434f54">i</span> <span style="color:#728e00">&lt;</span> <span style="color:#434f54">A</span>.<span style="color:#434f54">size</span>()) {
		<span style="color:#728e00">if</span>(<span style="color:#434f54">A</span>[<span style="color:#434f54">i</span>] <span style="color:#728e00">==</span> <span style="color:#434f54">B</span>[<span style="color:#434f54">j</span>]) <span style="color:#434f54">i</span> <span style="color:#728e00">++</span>, <span style="color:#434f54">j</span> <span style="color:#728e00">++</span>;
		<span style="color:#728e00">else</span> <span style="color:#728e00">if</span>(<span style="color:#434f54">j</span>) <span style="color:#434f54">j</span> <span style="color:#728e00">=</span> <span style="color:#434f54">pre</span>[<span style="color:#434f54">j</span> <span style="color:#728e00">-</span> <span style="color:#8a7b52">1</span>];
		<span style="color:#728e00">else</span> <span style="color:#434f54">i</span> <span style="color:#728e00">++</span>;
		<span style="color:#728e00">if</span>(<span style="color:#434f54">j</span> <span style="color:#728e00">==</span> <span style="color:#434f54">B</span>.<span style="color:#434f54">size</span>()) <span style="color:#95a5a6">//匹配成功
</span><span style="color:#95a5a6"></span>            <span style="color:#728e00">return</span> <span style="color:#728e00">true</span>;
	}
    <span style="color:#728e00">return</span> <span style="color:#728e00">false</span>;
}
</code></pre></div><h2 id="预处理">预处理 <a class="anchor" href="#%e9%a2%84%e5%a4%84%e7%90%86">¶</a></h2><p>$pre[ \ ]$ 数组的求法和 <code>KMP</code> 的主程序很相似.</p>
<p>指针 $i,j$ 都指向 $B$ 串，表示当前求的是 $B[0\cdots i]$ 的公共前后缀长度 $pre[i]$.并且 $B[0\cdots i]$ 的公共前后缀为 $B[0\cdots j]$，即 $pre[i]=j+1$.</p>
<p>因为 $pre[0]=0$ 不用求，所以直接从 $pre[1]$ 开始求就好，初始时 $i=1,j=0$.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
B<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> i<span style="color:#728e00">}{</span>↓<span style="color:#728e00">}}{</span>aba<span style="color:#728e00">}</span>bc<span style="color:#728e00">\\</span>
B<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> j<span style="color:#728e00">}{</span>↑<span style="color:#728e00">}}{</span>a<span style="color:#728e00">}</span>babc
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div><p>然后，我们直接采用 <a href="../../../../docs/NOI/String/KMP/#%E5%8E%9F%E7%90%86"><code>KMP</code> 主程序</a> 的策略：</p>
<ol>
<li>
<p>如果 $B[i]=B[j]$，那么 $pre[i]=j+1$，并将 $i$ 和 $j$ 同时右移一位.</p>
</li>
<li>
<p>如果 $B[i]≠B[j]$，又分两种情况讨论：</p>
<ul>
<li>
<p>$j≠0$ 时，绿串的公共前后缀长度为 $pre[j-1]$.那么就令 $j=pre[j-1]$.</p>
</li>
<li>
<p>$j=0$ 时，绿串长度为 $0$，$j$ 不能再往左移了.此时只能将 $i$ 右移一位.</p>
</li>
</ul>
</li>
<li>
<p>重复前两步，直到 $pre[ \ ]$ 全部求完.</p>
</li>
</ol>
<p>为什么可以这么做呢？因为仅当 $B[i]$ 和 $B[j]$ 前的若干个字符相匹配时，$B[0\cdots j]$ 才可能是公共前后缀.而 <code>KMP</code> 的主程序能够维护这一特征.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
B<span style="color:#728e00">&amp;</span>=ab<span style="color:#728e00">\underline</span><span style="color:#728e00">{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}}</span><span style="color:#728e00">\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> i<span style="color:#728e00">}{</span>↓<span style="color:#728e00">}}{</span>c<span style="color:#728e00">}</span><span style="color:#728e00">\\</span>
B<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\underline</span><span style="color:#728e00">{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}}</span><span style="color:#728e00">\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> j<span style="color:#728e00">}{</span>↑<span style="color:#728e00">}}{</span>a<span style="color:#728e00">}</span>bc
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div><p>也就是说，预处理 $pre[ \ ]$ 数组，和 <code>KMP</code> 的主程序，其实是在干同一件事情.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00979d">int</span> <span style="color:#434f54">pre</span>[];

<span style="color:#00979d">void</span> <span style="color:#d35400">getPre</span>(<span style="color:#434f54">string</span> <span style="color:#434f54">B</span>) {
	<span style="color:#00979d">int</span> <span style="color:#434f54">i</span> <span style="color:#728e00">=</span> <span style="color:#8a7b52">1</span>, <span style="color:#434f54">j</span> <span style="color:#728e00">=</span> <span style="color:#8a7b52">0</span>; <span style="color:#95a5a6">// 注意 i = 1
</span><span style="color:#95a5a6"></span>	<span style="color:#728e00">while</span>(<span style="color:#434f54">i</span> <span style="color:#728e00">&lt;</span> <span style="color:#434f54">B</span>.<span style="color:#434f54">size</span>()) {
		<span style="color:#728e00">if</span>(<span style="color:#434f54">B</span>[<span style="color:#434f54">i</span>] <span style="color:#728e00">==</span> <span style="color:#434f54">B</span>[<span style="color:#434f54">j</span>]) <span style="color:#434f54">pre</span>[<span style="color:#434f54">i</span>] <span style="color:#728e00">=</span> <span style="color:#434f54">j</span> <span style="color:#728e00">+</span> <span style="color:#8a7b52">1</span>, <span style="color:#434f54">i</span> <span style="color:#728e00">++</span>, <span style="color:#434f54">j</span> <span style="color:#728e00">++</span>;
		<span style="color:#728e00">else</span> <span style="color:#728e00">if</span>(<span style="color:#434f54">j</span>) <span style="color:#434f54">j</span> <span style="color:#728e00">=</span> <span style="color:#434f54">pre</span>[<span style="color:#434f54">j</span> <span style="color:#728e00">-</span> <span style="color:#8a7b52">1</span>];
		<span style="color:#728e00">else</span> <span style="color:#434f54">i</span> <span style="color:#728e00">++</span>;
	}
}
</code></pre></div><h2 id="模板">模板 <a class="anchor" href="#%e6%a8%a1%e6%9d%bf">¶</a></h2><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#728e00">const</span> <span style="color:#00979d">int</span> <span style="color:#434f54">N</span> <span style="color:#728e00">=</span> <span style="color:#8a7b52">1e6</span>;
<span style="color:#00979d">int</span> <span style="color:#434f54">pre</span>[<span style="color:#434f54">N</span>];

<span style="color:#00979d">void</span> <span style="color:#d35400">getPre</span>(<span style="color:#434f54">string</span> <span style="color:#434f54">str</span>) {
	<span style="color:#00979d">int</span> <span style="color:#434f54">i</span> <span style="color:#728e00">=</span> <span style="color:#8a7b52">1</span>, <span style="color:#434f54">j</span> <span style="color:#728e00">=</span> <span style="color:#8a7b52">0</span>;
	<span style="color:#728e00">while</span>(<span style="color:#434f54">i</span> <span style="color:#728e00">&lt;</span> <span style="color:#434f54">str</span>.<span style="color:#434f54">size</span>()) {
		<span style="color:#728e00">if</span>(<span style="color:#434f54">str</span>[<span style="color:#434f54">i</span>] <span style="color:#728e00">==</span> <span style="color:#434f54">str</span>[<span style="color:#434f54">j</span>]) <span style="color:#434f54">pre</span>[<span style="color:#434f54">i</span>] <span style="color:#728e00">=</span> <span style="color:#434f54">j</span> <span style="color:#728e00">+</span> <span style="color:#8a7b52">1</span>, <span style="color:#434f54">i</span> <span style="color:#728e00">++</span>, <span style="color:#434f54">j</span> <span style="color:#728e00">++</span>;
		<span style="color:#728e00">else</span> <span style="color:#728e00">if</span>(<span style="color:#434f54">j</span>) <span style="color:#434f54">j</span> <span style="color:#728e00">=</span> <span style="color:#434f54">pre</span>[<span style="color:#434f54">j</span> <span style="color:#728e00">-</span> <span style="color:#8a7b52">1</span>];
		<span style="color:#728e00">else</span> <span style="color:#434f54">i</span> <span style="color:#728e00">++</span>;
	}
}

<span style="color:#00979d">bool</span> <span style="color:#d35400">kmp</span>(<span style="color:#434f54">string</span> <span style="color:#434f54">str</span>, <span style="color:#434f54">string</span> <span style="color:#434f54">substr</span>) {
	<span style="color:#434f54">getPre</span>(<span style="color:#434f54">substr</span>);
	<span style="color:#00979d">int</span> <span style="color:#434f54">i</span> <span style="color:#728e00">=</span> <span style="color:#8a7b52">0</span>, <span style="color:#434f54">j</span> <span style="color:#728e00">=</span> <span style="color:#8a7b52">0</span>;
	<span style="color:#728e00">while</span>(<span style="color:#434f54">i</span> <span style="color:#728e00">&lt;</span> <span style="color:#434f54">str</span>.<span style="color:#434f54">size</span>()) {
		<span style="color:#728e00">if</span>(<span style="color:#434f54">str</span>[<span style="color:#434f54">i</span>] <span style="color:#728e00">==</span> <span style="color:#434f54">substr</span>[<span style="color:#434f54">j</span>]) <span style="color:#434f54">i</span> <span style="color:#728e00">++</span>, <span style="color:#434f54">j</span> <span style="color:#728e00">++</span>;
		<span style="color:#728e00">else</span> <span style="color:#728e00">if</span>(<span style="color:#434f54">j</span>) <span style="color:#434f54">j</span> <span style="color:#728e00">=</span> <span style="color:#434f54">pre</span>[<span style="color:#434f54">j</span> <span style="color:#728e00">-</span> <span style="color:#8a7b52">1</span>];
		<span style="color:#728e00">else</span> <span style="color:#434f54">i</span> <span style="color:#728e00">++</span>;
		<span style="color:#728e00">if</span>(<span style="color:#434f54">j</span> <span style="color:#728e00">==</span> <span style="color:#434f54">substr</span>.<span style="color:#434f54">size</span>())
            <span style="color:#728e00">return</span> <span style="color:#728e00">true</span>;
	}
    <span style="color:#728e00">return</span> <span style="color:#728e00">false</span>;
}

<span style="color:#00979d">int</span> <span style="color:#d35400">main</span>() {
	<span style="color:#434f54">string</span> <span style="color:#434f54">str</span>, <span style="color:#434f54">substr</span>;
	<span style="color:#434f54">cin</span> <span style="color:#728e00">&gt;&gt;</span> <span style="color:#434f54">str</span> <span style="color:#728e00">&gt;&gt;</span> <span style="color:#434f54">substr</span>;
	<span style="color:#434f54">cout</span> <span style="color:#728e00">&lt;&lt;</span> <span style="color:#434f54">kmp</span>(<span style="color:#434f54">str</span>, <span style="color:#434f54">substr</span>);
	<span style="color:#728e00">return</span> <span style="color:#8a7b52">0</span>;
} 
</code></pre></div><section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>字符串 $s$ 左部的任意子串为 $s$ 的前缀，且 $s$ 的前缀不能是 $s$ 本身.例如 <code>freeze</code> 的前缀有 <code>f</code>，<code>fr</code>，<code>fre</code>，<code>free</code>，<code>freez</code>.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>

  
</div>

</article>

  </main>

  <script src="../../../../js/jquery.min.js"></script>



<script defer>
function IsPC() {  
  var userAgentInfo = navigator.userAgent;
  var Agents = new Array("Android", "iPhone", "SymbianOS", "Windows Phone", "iPad", "iPod");  
  for (var v = 0; v < Agents.length; v ++) {  
    if (userAgentInfo.indexOf(Agents[v]) > 0) {
      return false;
    }
  }
  return true;
}
function detectZoom() {
  var ratio = 0,
  screen = window.screen,
  ua = navigator.userAgent.toLowerCase();
  if (window.devicePixelRatio !== undefined)
    ratio = window.devicePixelRatio;
  else if (~ua.indexOf('msie')) {
    if (screen.deviceXDPI && screen.logicalXDPI)
      ratio = screen.deviceXDPI / screen.logicalXDPI;
  }
  else if (window.outerWidth !== undefined && window.innerWidth !== undefined)
    ratio = window.outerWidth / window.innerWidth;
  
  if (ratio)
    ratio = Math.round(ratio * 100);
  return ratio;
}
$('.markdown').find('img').each(function(id, el, arr) {
  if (el.className == 'alt')
    return;
  el.className = "md__image";
  var src = el.getAttribute('src');
  if (IsPC()) {
    if (el.style.zoom)
      el.style.zoom = parseFloat(el.style.zoom) / detectZoom();
    else
      el.style.zoom = 100 / detectZoom();
  }
});
</script>



<link rel="stylesheet" href="../../../../katex/katex.min.css">
<script src="../../../../katex/katex.min.js"></script>
<script src="../../../../katex/auto-render.min.js"></script>

<script>
function renderTex() {
  renderMathInElement(document.body, {
    trust: true,
    delimiters: [
      { left: "$$", right: "$$", display: true },
      { left: "$", right: "$", display: false }
    ],
    macros: {
      
      "\\d": "\\text{d}",
      "\\zh": "\\footnotesize \\ ",
      "\\en": "\\normalsize \\ ",
      "\\su": "\\displaystyle",
      "\\eq": "\\Longleftrightarrow",
      "\\intro": "\\Longrightarrow",
      "\\mathring": "\\overset\{\\normalsizeₒ\}",
      "\\arccot": "\\text\{arccot\} \\, ",
      "\\xor": "\\text\{xor\} \\, ",
      "\\mex": "\\text\{mex\} \\, "
    }
  });
}  
document.addEventListener("DOMContentLoaded", function() {
  renderTex();
});
$('.language-latex').each(function(id, el, arr) {
  function toText(text) { 
    var temp = document.createElement("div"); 
    temp.innerHTML = text; 
    var output = temp.innerText || temp.textContent; 
    temp = null; 
    return output; 
  } 
  tex = toText(el.innerHTML);
  el.parentElement.outerHTML = '<div>$$' + tex + '$$</div>';
});
</script>


<script>
$(window).scroll(function(e) {
  if ($('main').css('display') == 'flex')
    $(this).scrollTop(0);
});
$('main').scroll(function(e) {
  if ($('main').css('display') == 'flex')
    $(this).scrollTop(0);
});
document.body.scroll="no";
</script>
</body>

</html>